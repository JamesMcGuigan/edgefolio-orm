if(typeof ss!=="undefined"){ss.mixin(ss);if(typeof _!=="undefined"){_.mixin(_(ss).pick(["median","standardDeviation","sum","product","sampleSkewness","mean","min","max","quantile","geometricMean","harmonicMean","root_mean_square"]).omit(_.keys(_.prototype)).value())}}if(typeof moment!=="undefined"){moment.defaultFormat="YYYY-MM-DD\\THH:mm:ss.SSS\\Z";moment.tz.setDefault("UTC");if(!moment.prototype._toString){moment.prototype._toString=moment.prototype.toString;moment.prototype._toISOString=moment.prototype.toISOString;moment._toISOStringCache={};moment.prototype.toString=moment.prototype.toISOString=function(){var cache_key=Number(this);if(!moment._toISOStringCache[cache_key]){moment._toISOStringCache[cache_key]=this._toISOString()}return moment._toISOStringCache[cache_key]}}}angular.module("edgefolio.models",["edgefolio.constants"]);angular.module("edgefolio.models").value("_",window._);angular.module("edgefolio.models").value("$",window.$);angular.module("edgefolio.models").value("JS",window.JS);angular.module("edgefolio.models").value("moment",window.moment);angular.module("edgefolio.models").value("kurtosis",require("compute-kurtosis"));angular.module("edgefolio.models").value("covariance",require("compute-covariance"));angular.module("edgefolio.enterprise.widgets",["edgefolio.enterprise.widgets.documentation","edgefolio.enterprise.widgets.edgefolioStatisticsTable","edgefolio.enterprise.widgets.selectbox","edgefolio.enterprise.widgets.timeframeSelector","edgefolio.enterprise.widgets.timeseriesTable","edgefolio.enterprise.widgets.fundgroupMenu"]);angular.module("edgefolio.constants",["edgefolio.constants.AggregationDefinitions","edgefolio.constants.CountryCodes","edgefolio.constants.CurrencySymbolMap","edgefolio.constants.HttpStatusCodes","edgefolio.constants.KeyCodes","edgefolio.constants.LegalStructures","edgefolio.constants.TimeframeDefinitions"]);angular.module("edgefolio.constants.AggregationDefinitions",[]).constant("AggregationDefinitions",{annualized_alpha:{id:"annualized_alpha",name:"Alpha (Annualized)*",shortName:"Alpha*",unit:"%"},beta:{id:"beta",name:"Beta*",shortName:"Beta*",negative:function(){return false}},annualized_compounded_return:{id:"annualized_compounded_return",name:"Compounded Return (Annualized)",benchmark_id:"benchmark_annualized_compounded_return",shortName:"CAGR",unit:"%"},annualized_compounded_excess_return:{id:"annualized_compounded_excess_return",name:"Compounded Excess Return (Annualized)",shortName:"Excess",unit:"%"},annualized_volatility:{id:"annualized_volatility",name:"Volatility (Annualized)",benchmark_id:"benchmark_annualized_volatility",shortName:"Vol.",unit:"%",negative:function(value){if(value>15){return true}}},maximum_drawdown:{id:"maximum_drawdown",name:"Maximum Drawdown",benchmark_id:"benchmark_maximum_drawdown",shortName:"Max DD",unit:"%",negative:function(value){if(Math.abs(value)>20){return true}}},annualized_sharpe_ratio:{id:"annualized_sharpe_ratio",name:"Sharpe Ratio (Annualized)*",shortName:"Sharpe*",negative:function(){return false}},annualized_sortino_ratio:{id:"annualized_sortino_ratio",name:"Sortino Ratio (Annualized)*",shortName:"Sortino",negative:function(){return false}},correlation_coefficient:{id:"correlation_coefficient",name:"Correlation Coefficient",shortName:"Correlation",unit:"%",negative:function(){return false}},expected_return:{id:"expected_return",name:"Expected Return",benchmark_id:"benchmark_expected_return",shortName:"Exp. Return",unit:"%",transformValue:function(value){return(Math.pow(1+value/100,12)-1)*100}},skewness_risk:{id:"skewness_risk",name:"Skewness Risk",benchmark_id:"benchmark_skewness_risk",shortName:"Skewness",negative:function(value){if(Math.abs(value)>.8){return true}}},kurtosis_risk:{id:"kurtosis_risk",name:"Kurtosis Risk",shortName:"Kurtosis",benchmark_id:"benchmark_kurtosis_risk",negative:function(value){if(Math.abs(value)>=3){return true}}}});angular.module("edgefolio.constants.application",["edgefolio.constants"]).provider("CONST",function(){this.$get=function(AggregationDefinitions,Colors,TimeframeDefinitions){return{ANALYTICS_AGGREGATIONS:_.values(AggregationDefinitions),TIMEFRAME:TimeframeDefinitions,MONTHS:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],MAX_GRAPH_POINTS:5e3,ADD_TO_GROUP_LIMIT:100,PROFILE_PATH:"/hedge-funds",DASHBOARD_PATH:"/dashboard",SEARCH_PATH:"/search",PAGE_LISTING:25,KEYWORD_PLACE_HOLDER:["try a fund's name","try a fund manager's name","try a management company's name","look through funds strategies","try a service provider's name","try a fund or manager's domicile"],STRATEGY:["U.S. Long/Short Equity","U.S. Small Cap Long/Short Equity","Asia/Pacific Long/Short Equity","Europe Long/Short Equity","Emerging Markets Long/Short Equity","Global Long/Short Equity","Bear Market Equity","Long/Short Debt","Convertible Arbitrage","Equity Market Neutral","Debt Arbitrage","Systematic Futures","Global Macro","Distressed Securities","Event Driven","Multistrategy","China Long/Short Equity","Currency","Diversified Arbitrage","Merger Arbitrage","Volatility","Long-Only Debt","Emerging Markets Long-Only Equity","Long-Only Equity","Long-Only Other"],MAPSTYLE:[{featureType:"water",elementType:"all",stylers:[{hue:"#daeffe"},{saturation:-50},{lightness:50},{visibility:"simplified"}]},{featureType:"landscape",elementType:"all",stylers:[{hue:"#ffffff"},{saturation:-100},{lightness:100},{visibility:"simplified"}]},{featureType:"poi",elementType:"all",stylers:[{hue:"#ffffff"},{saturation:-100},{lightness:100},{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#cdfbd9"},{saturation:-20},{lightness:20},{visibility:"simplified"}]},{featureType:"transit",elementType:"all",stylers:[{hue:"#ffe9e9"},{saturation:0},{lightness:0},{visibility:"on"}]},{featureType:"administrative.country",elementType:"labels",stylers:[{color:"#d4d6da"},{saturation:0},{lightness:-20},{visibility:"simplified"}]},{featureType:"administrative.country",elementType:"geometry",stylers:[{color:"#d4d6da"},{saturation:0},{lightness:0},{visibility:"on"}]},{featureType:"administrative.locality",elementType:"all",stylers:[{color:"#d4d6da"},{saturation:0},{lightness:-20},{visibility:"simplified"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#d4d6da"},{saturation:-90},{lightness:70},{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{hue:"#d4d6da"},{saturation:-90},{lightness:60},{visibility:"simplified"}]}],getPath:function(flow,form){return form.path}}}});angular.module("edgefolio.constants.CountryCodes",[]).constant("CountryCodes",{"":"",AFG:"Afghanistan",ALA:"Åland Islands",ALB:"Albania",DZA:"Algeria",ASM:"American Samoa",AND:"Andorra",AGO:"Angola",AIA:"Anguilla",ATA:"Antarctica",ATG:"Antigua and Barbuda",ARG:"Argentina",ARM:"Armenia",ABW:"Aruba",AUS:"Australia",AUT:"Austria",AZE:"Azerbaijan",BHS:"Bahamas",BHR:"Bahrain",BGD:"Bangladesh",BRB:"Barbados",BLR:"Belarus",BEL:"Belgium",BLZ:"Belize",BEN:"Benin",BMU:"Bermuda",BTN:"Bhutan",BOL:"Bolivia, Plurinational State of",BES:"Bonaire, Sint Eustatius and Saba",BIH:"Bosnia and Herzegovina",BWA:"Botswana",BVT:"Bouvet Island",BRA:"Brazil",IOT:"British Indian Ocean Territory",BRN:"Brunei Darussalam",BGR:"Bulgaria",BFA:"Burkina Faso",BDI:"Burundi",KHM:"Cambodia",CMR:"Cameroon",CAN:"Canada",CPV:"Cape Verde",CYM:"Cayman Islands",CAF:"Central African Republic",TCD:"Chad",CHL:"Chile",CHN:"China",CXR:"Christmas Island",CCK:"Cocos (Keeling) Islands",COL:"Colombia",COM:"Comoros",COG:"Congo",COD:"Congo, The Democratic Republic of the",COK:"Cook Islands",CRI:"Costa Rica",CIV:"Côte d'Ivoire",HRV:"Croatia",CUB:"Cuba",CUW:"Curaçao",CYP:"Cyprus",CZE:"Czech Republic",DNK:"Denmark",DJI:"Djibouti",DMA:"Dominica",DOM:"Dominican Republic",ECU:"Ecuador",EGY:"Egypt",SLV:"El Salvador",GNQ:"Equatorial Guinea",ERI:"Eritrea",EST:"Estonia",ETH:"Ethiopia",FLK:"Falkland Islands (Malvinas)",FRO:"Faroe Islands",FJI:"Fiji",FIN:"Finland",FRA:"France",GUF:"French Guiana",PYF:"French Polynesia",ATF:"French Southern Territories",GAB:"Gabon",GMB:"Gambia",GEO:"Georgia",DEU:"Germany",GHA:"Ghana",GIB:"Gibraltar",GRC:"Greece",GRL:"Greenland",GRD:"Grenada",GLP:"Guadeloupe",GUM:"Guam",GTM:"Guatemala",GGY:"Guernsey",GIN:"Guinea",GNB:"Guinea-Bissau",GUY:"Guyana",HTI:"Haiti",HMD:"Heard Island and McDonald Islands",VAT:"Holy See (Vatican City State)",HND:"Honduras",HKG:"Hong Kong",HUN:"Hungary",ISL:"Iceland",IND:"India",IDN:"Indonesia",IRN:"Iran, Islamic Republic of",IRQ:"Iraq",IRL:"Ireland",IMN:"Isle of Man",ISR:"Israel",ITA:"Italy",JAM:"Jamaica",JPN:"Japan",JEY:"Jersey",JOR:"Jordan",KAZ:"Kazakhstan",KEN:"Kenya",KIR:"Kiribati",PRK:"Korea, Democratic People's Republic of",KOR:"Korea, Republic of",KWT:"Kuwait",KGZ:"Kyrgyzstan",LAO:"Lao People's Democratic Republic",LVA:"Latvia",LBN:"Lebanon",LSO:"Lesotho",LBR:"Liberia",LBY:"Libya",LIE:"Liechtenstein",LTU:"Lithuania",LUX:"Luxembourg",MAC:"Macao",MKD:"Macedonia, Republic of",MDG:"Madagascar",MWI:"Malawi",MYS:"Malaysia",MDV:"Maldives",MLI:"Mali",MLT:"Malta",MHL:"Marshall Islands",MTQ:"Martinique",MRT:"Mauritania",MUS:"Mauritius",MYT:"Mayotte",MEX:"Mexico",FSM:"Micronesia, Federated States of",MDA:"Moldova, Republic of",MCO:"Monaco",MNG:"Mongolia",MNE:"Montenegro",MSR:"Montserrat",MAR:"Morocco",MOZ:"Mozambique",MMR:"Myanmar",NAM:"Namibia",NRU:"Nauru",NPL:"Nepal",NLD:"Netherlands",NCL:"New Caledonia",NZL:"New Zealand",NIC:"Nicaragua",NER:"Niger",NGA:"Nigeria",NIU:"Niue",NFK:"Norfolk Island",MNP:"Northern Mariana Islands",NOR:"Norway",OMN:"Oman",PAK:"Pakistan",PLW:"Palau",PSE:"Palestine, State of",PAN:"Panama",PNG:"Papua New Guinea",PRY:"Paraguay",PER:"Peru",PHL:"Philippines",PCN:"Pitcairn",POL:"Poland",PRT:"Portugal",PRI:"Puerto Rico",QAT:"Qatar",REU:"Réunion",ROU:"Romania",RUS:"Russian Federation",RWA:"Rwanda",BLM:"Saint Barthélemy",SHN:"Saint Helena, Ascension and Tristan da Cunha",KNA:"Saint Kitts and Nevis",LCA:"Saint Lucia",MAF:"Saint Martin (French part)",SPM:"Saint Pierre and Miquelon",VCT:"Saint Vincent and the Grenadines",WSM:"Samoa",SMR:"San Marino",STP:"Sao Tome and Principe",SAU:"Saudi Arabia",SEN:"Senegal",SRB:"Serbia",SYC:"Seychelles",SLE:"Sierra Leone",SGP:"Singapore",SXM:"Sint Maarten (Dutch part)",SVK:"Slovakia",SVN:"Slovenia",SLB:"Solomon Islands",SOM:"Somalia",ZAF:"South Africa",SGS:"South Georgia and the South Sandwich Islands",ESP:"Spain",LKA:"Sri Lanka",SDN:"Sudan",SUR:"Suriname",SSD:"South Sudan",SJM:"Svalbard and Jan Mayen",SWZ:"Swaziland",SWE:"Sweden",CHE:"Switzerland",SYR:"Syrian Arab Republic",TWN:"Taiwan, Province of China",TJK:"Tajikistan",TZA:"Tanzania, United Republic of",THA:"Thailand",TLS:"Timor-Leste",TGO:"Togo",TKL:"Tokelau",TON:"Tonga",TTO:"Trinidad and Tobago",TUN:"Tunisia",TUR:"Turkey",TKM:"Turkmenistan",TCA:"Turks and Caicos Islands",TUV:"Tuvalu",UGA:"Uganda",UKR:"Ukraine",ARE:"United Arab Emirates",GBR:"United Kingdom",USA:"United States",UMI:"United States Minor Outlying Islands",URY:"Uruguay",UZB:"Uzbekistan",VUT:"Vanuatu",VEN:"Venezuela, Bolivarian Republic of",VNM:"Viet Nam",VGB:"Virgin Islands, British",VIR:"Virgin Islands, U.S.",WLF:"Wallis and Futuna",ESH:"Western Sahara",YEM:"Yemen",ZMB:"Zambia",ZWE:"Zimbabwe"});angular.module("edgefolio.constants.CurrencySymbolMap",[]).constant("CurrencySymbolMap",{ALL:"L",AFN:"؋",ARS:"$",AWG:"ƒ",AUD:"$",AZN:"₼",BSD:"$",BBD:"$",BYR:"p.",BZD:"BZ$",BMD:"$",BOB:"Bs.",BAM:"KM",BWP:"P",BGN:"лв",BRL:"R$",BND:"$",KHR:"៛",CAD:"$",KYD:"$",CLP:"$",CNY:"¥",COP:"$",CRC:"₡",HRK:"kn",CUP:"₱",CZK:"Kč",DKK:"kr",DOP:"RD$",XCD:"$",EGP:"£",SVC:"$",EEK:"kr",EUR:"€",FKP:"£",FJD:"$",GHC:"¢",GIP:"£",GTQ:"Q",GGP:"£",GYD:"$",HNL:"L",HKD:"$",HUF:"Ft",ISK:"kr",INR:"₹",IDR:"Rp",IRR:"﷼",IMP:"£",ILS:"₪",JMD:"J$",JPY:"¥",JEP:"£",KES:"KSh",KZT:"лв",KPW:"₩",KRW:"₩",KGS:"лв",LAK:"₭",LVL:"Ls",LBP:"£",LRD:"$",LTL:"Lt",MKD:"ден",MYR:"RM",MUR:"₨",MXN:"$",MNT:"₮",MZN:"MT",NAD:"$",NPR:"₨",ANG:"ƒ",NZD:"$",NIO:"C$",NGN:"₦",NOK:"kr",OMR:"﷼",PKR:"₨",PAB:"B/.",PYG:"Gs",PEN:"S/.",PHP:"₱",PLN:"zł",QAR:"﷼",RON:"lei",RUB:"₽",SHP:"£",SAR:"﷼",RSD:"Дин.",SCR:"₨",SGD:"$",SBD:"$",SOS:"S",ZAR:"R",LKR:"₨",SEK:"kr",CHF:"CHF",SRD:"$",SYP:"£",TZS:"TSh",TWD:"NT$",THB:"฿",TTD:"TT$",TRY:"",TRL:"₤",TVD:"$",UGX:"USh",UAH:"₴",GBP:"£",USD:"$",UYU:"$U",UZS:"лв",VEF:"Bs",VND:"₫",YER:"﷼",ZWD:"Z$"});angular.module("edgefolio.constants.HttpStatusCodes",[]).service("HttpStatusCodes",function(){var statusCodes={};statusCodes[this.ACCEPTED=202]="Accepted";statusCodes[this.BAD_GATEWAY=502]="Bad Gateway";statusCodes[this.BAD_REQUEST=400]="Bad Request";statusCodes[this.CONFLICT=409]="Conflict";statusCodes[this.CONTINUE=100]="Continue";statusCodes[this.CREATED=201]="Created";statusCodes[this.EXPECTATION_FAILED=417]="Expectation Failed";statusCodes[this.FAILED_DEPENDENCY=424]="Failed Dependency";statusCodes[this.FORBIDDEN=403]="Forbidden";statusCodes[this.GATEWAY_TIMEOUT=504]="Gateway Timeout";statusCodes[this.GONE=410]="Gone";statusCodes[this.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP Version Not Supported";statusCodes[this.INSUFFICIENT_SPACE_ON_RESOURCE=419]="Insufficient Space on Resource";statusCodes[this.INSUFFICIENT_STORAGE=507]="Insufficient Storage";statusCodes[this.INTERNAL_SERVER_ERROR=500]="Server Error";statusCodes[this.LENGTH_REQUIRED=411]="Length Required";statusCodes[this.LOCKED=423]="Locked";statusCodes[this.METHOD_FAILURE=420]="Method Failure";statusCodes[this.METHOD_NOT_ALLOWED=405]="Method Not Allowed";statusCodes[this.MOVED_PERMANENTLY=301]="Moved Permanently";statusCodes[this.MOVED_TEMPORARILY=302]="Moved Temporarily";statusCodes[this.MULTI_STATUS=207]="Multi-Status";statusCodes[this.MULTIPLE_CHOICES=300]="Multiple Choices";statusCodes[this.NETWORK_AUTHENTICATION_REQUIRED=511]="Network Authentication Required";statusCodes[this.NO_CONTENT=204]="No Content";statusCodes[this.NON_AUTHORITATIVE_INFORMATION=203]="Non Authoritative Information";statusCodes[this.NOT_ACCEPTABLE=406]="Not Acceptable";statusCodes[this.NOT_FOUND=404]="Not Found";statusCodes[this.NOT_IMPLEMENTED=501]="Not Implemented";statusCodes[this.NOT_MODIFIED=304]="Not Modified";statusCodes[this.OK=200]="OK";statusCodes[this.PARTIAL_CONTENT=206]="Partial Content";statusCodes[this.PAYMENT_REQUIRED=402]="Payment Required";statusCodes[this.PRECONDITION_FAILED=412]="Precondition Failed";statusCodes[this.PRECONDITION_REQUIRED=428]="Precondition Required";statusCodes[this.PROCESSING=102]="Processing";statusCodes[this.PROXY_AUTHENTICATION_REQUIRED=407]="Proxy Authentication Required";statusCodes[this.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="Request Header Fields Too Large";statusCodes[this.REQUEST_TIMEOUT=408]="Request Timeout";statusCodes[this.REQUEST_TOO_LONG=413]="Request Entity Too Large";statusCodes[this.REQUEST_URI_TOO_LONG=414]="Request-URI Too Long";statusCodes[this.REQUESTED_RANGE_NOT_SATISFIABLE=416]="Requested Range Not Satisfiable";statusCodes[this.RESET_CONTENT=205]="Reset Content";statusCodes[this.SEE_OTHER=303]="See Other";statusCodes[this.SERVICE_UNAVAILABLE=503]="Service Unavailable";statusCodes[this.SWITCHING_PROTOCOLS=101]="Switching Protocols";statusCodes[this.TEMPORARY_REDIRECT=307]="Temporary Redirect";statusCodes[this.TOO_MANY_REQUESTS=429]="Too Many Requests";statusCodes[this.UNAUTHORIZED=401]="Unauthorized";statusCodes[this.UNPROCESSABLE_ENTITY=422]="Unprocessable Entity";statusCodes[this.UNSUPPORTED_MEDIA_TYPE=415]="Unsupported Media Type";statusCodes[this.USE_PROXY=305]="Use Proxy";this.getStatusText=function(statusCode){if(statusCodes.hasOwnProperty(statusCode)){return statusCodes[statusCode]}else{console.log("HttpStatusCodes.js::getStatusText()","Status code does not exist: ",statusCode);return""}}});angular.module("edgefolio.constants.KeyCodes",[]).constant("KeyCodes",{enter:13,up:38,down:40,left:37,right:39,escape:27,space:32});angular.module("edgefolio.constants.LegalStructures",[]).constant("LegalStructures",{"01":"Partnership (3C1)","02":"Partnership (3C7)","03":"Corporation","04":"Limited Liability Company","05":"Closed Ended Investment Company","06":"Exempted Limited Partnership","08":"Open Ended Investment Company","09":"SICAV",11:"Non-Exempted Limited Partnership",12:"Registered Hedge Fund",20:"SeparateAccount",22:"Unit Trust",23:"FCP",24:"SICAF",25:"Trust Units",26:"Investment Trust",27:"Unit Investment Trust",28:"Grantor Trust",29:"Trusts",30:"Pooled",31:"Custom Fund",32:"Market Index",33:"Managed Account",34:"Unstructured Hedge Fund",35:"FCIMT",36:"FIP",37:"FCPI",38:"FCPE",39:"SIMCAV",40:"Structured Product",41:"Property Syndicate",42:"IGSA",43:"CIT",45:"Unlisted Closed End Investment Company",50:"Limited Liability Partnership"});angular.module("edgefolio.constants.TimeframeDefinitions",[]).constant("TimeframeDefinitions",[{id:0,name:"Since Inception"},{id:120,name:"10Y"},{id:60,name:"5Y"},{id:36,name:"3Y"},{id:12,name:"1Y"},{id:6,name:"6M"},{id:3,name:"3M"}]);angular.module("edgefolio.enterprise.widgets.documentation",[]).directive("edgefolioDocumentation",function(DocumentationWidget){return{restrict:"EA",link:function(scope,element){DocumentationWidget(element,scope)}}}).run(function(Edgefolio,DocumentationWidget){Edgefolio.DocumentationWidget=DocumentationWidget}).factory("DocumentationWidget",function($compile,$interpolate,$log){var DocumentationWidget=function(selector,scope){$(selector).each(function(index,element){DocumentationWidget.injectDocumentation($(element),scope)})};DocumentationWidget.__proto__={prettyPrintHtml:function(element){element=$(element).clone().find("aside").remove().end();var html=element.html()||"";html=html.replace(/^\s+|\s+$/gm,"");html=html.replace(/<(([\w-]+)[^>]*)>\s*<\/\2>/gm,"<$1\n/>");html=html.replace(/<([\w-]+)[\s\n]*\/>/g,"<$1/>");html=html.replace(/<\//g,"\n$&");html=html.replace(/\/></g,"/>\n<");html=html.replace(/ [\w-]+=/g,"\n    $&");html=html.replace(/(<[\w-]{1,6})[\s\n]+(\w+)/g,"$1 $2");html=html.replace(/\n+/g,"\n");return html},injectHtmlSource:function(element,scope){var html=DocumentationWidget.prettyPrintHtml(element);$("<pre/>").text(html).prependTo(element)},silentConsoleError:function(func){$log._error=$log.error;$log.error=_.noop;try{func.apply(this)}catch(e){}$log.error=$log._error},injectControls:function(element,scope){var scope=(scope||$(element).scope()).$new();var html=DocumentationWidget.prettyPrintHtml(element);var aside=$("<aside style='padding: 1em'/>").prependTo(element);var variables=_(html.match(/="([^"]+)["]|='([^']+)'/g)).map(function(varName){return varName.replace(/=["'](.*)["']/g,"$1")}).filter(function(varName){return!varName.match(/[()]/)}).sortBy().unique().value();_.forEach(variables,function(varName){this.silentConsoleError(function(){varName=varName.replace(/'/g,'"');var injectHtml=""+"<div style='overflow: scroll; max-height: 4.5em;'>"+"<input type='text'   ng-model='"+varName+"' ng-if='_.isString("+varName+") || _.isNull("+varName+") || _.isUndefined("+varName+")' style='width: 5em'/>"+"<input type='number' ng-model='"+varName+"' ng-if='_.isNumber("+varName+")' style='width: 5em'/>"+"<input type='text'   disabled='disabled'        ng-if='_.isObject("+varName+")' style='width: 5em; visibility: hidden'/>"+"<span>"+varName+": {{("+varName+")}}</span>"+"<span>&nbsp; ({{"+varName+" | typeof}})</span>"+"<div>";var injectElement=$compile(injectHtml)(scope);aside.append(injectElement)})},this)},injectDocumentation:function(element,scope){DocumentationWidget.injectControls(element,scope);DocumentationWidget.injectHtmlSource(element,scope);element.append("<hr style='margin: 2em 0'/>")}};return DocumentationWidget}).filter("typeof",function(){return function(any){if(_.isArray(any)){return"array"}if(_.isNull(any)){return"null"}if(_.isBoolean(any)){return"boolean"}if(any&&any.klass){return any.$$hashKey||any.uuid||any.displayName}return typeof any}});"use strict";angular.module("edgefolio.enterprise.widgets.selectbox",["edgefolio.models"]).controller("EdgefolioSelectboxController",function($scope,$q){$scope.state={loading:true,selectedItem:null};$scope.events={onChange:function(options){$scope.selectedId=_.get($scope,["state","selectedItem","id"])||null;if(_.isFunction($scope.onChange)){$scope.onChange({item:$scope.state.selectedItem})}}};$scope.reload=function(){$scope.label=String($scope.label||"").replace(/(\S)\s*:?\s*$/,"$1:");$scope.state.loading=true;var promises=_($scope.items).pluck("$loadPromise").filter().value();$q.all(promises).then(function(){$scope.state.loading=false;$scope.updateSelectedItem()})};$scope.updateSelectedItem=function(){$scope.state.selectedItem=_.find($scope.items,function(item){return item&&item.id==$scope.selectedId});$scope.state.selectedItem=$scope.state.selectedItem||_.first($scope.items);$scope.selectedId=_.get($scope,["state","selectedItem","id"])||null};$scope.$watch("selectedId",function(){if(arguments[0]!=arguments[1]){$scope.updateSelectedItem()}})}).directive("edgefolioSelectbox",function($q){return{restrict:"E",templateUrl:"/assets/whitelabel/enterprise/widgets/selectbox/selectbox.html",scope:{label:"@",items:"=?",selectedId:"=?",onChange:"&?"},controller:"EdgefolioSelectboxController",link:function($scope,element,attr){$scope.$watchCollection("[label, items, selectedId]",function(){$scope.reload()})}}}).directive("edgefolioSelectboxFundgroup",function(Edgefolio,FundGroups){return{restrict:"E",replace:true,templateUrl:"/assets/whitelabel/enterprise/widgets/selectbox/selectbox.html",scope:{selectedId:"=?",onChange:"&?",onDelete:"&?"},controller:"EdgefolioSelectboxController",link:function($scope,element,attr){$scope.label="Watchlist";$scope.items=[];$scope.$watch(function(){return Edgefolio.FundGroups.load().$$hashKey},function(){FundGroups.load().$preloadPromise.then(function(fundgroups){$scope.items=_.get(fundgroups,"results")})});$scope.$watch("items",function(){$scope.updateSelectedItem();$scope.reload()})}}}).directive("edgefolioSelectboxBenchmark",function(Edgefolio,Benchmarks){return{restrict:"E",replace:true,templateUrl:"/assets/whitelabel/enterprise/widgets/selectbox/selectbox.html",scope:{selectedId:"=?",onChange:"&?",onDelete:"&?"},controller:"EdgefolioSelectboxController",link:function($scope,element,attr){$scope.label="Benchmark";$scope.items=[];$scope.$watch(function(){return Edgefolio.Benchmarks.load().$$hashKey},function(){Benchmarks.load().$preloadPromise.then(function(benchmarks){$scope.items=_.get(benchmarks,"results")})});$scope.$watch("items",function(){$scope.updateSelectedItem();$scope.reload()})}}});"use strict";angular.module("edgefolio.enterprise.widgets.timeframeSelector",["edgefolio.models","edgefolio.constants.TimeframeDefinitions"]).directive("edgefolioTimeframeSelector",function($q,TimeframeDefinitions,ApiBaseClass,TimeSeries,FundGroup){return{restrict:"E",templateUrl:"/assets/whitelabel/enterprise/widgets/timeframeSelector/timeframeSelector.html",scope:{fundgroupId:"=?",items:"=?",selectedId:"=?",hideSinceInception:"=?"},controller:function($scope){$scope.events={onChange:function(options){$scope.state.selectedTimeframe=_.get(options,"timeframe");$scope.selectedId=_.get(options,"timeframe.id")||0},isValid:function(timeframe){if(timeframe.id===0){return true}if(_.size($scope.items)===0){return true}if(!_.isFinite($scope.state.maxMonths)){return true}if(timeframe.id<=$scope.state.maxMonths){return true}else{return false}}}},link:function($scope,element,attr){$scope.state={};$scope.state.timeframes=_(_(TimeframeDefinitions).cloneDeep()).reject($scope.hideSinceInception?{id:0}:false).value();$scope.state.maxMonths=0;$scope.data={fundgroup:null};$scope.reload=function(){var promises=_([$scope.items]).flatten(false).map(ApiBaseClass.loadUuid).map(function(instance){return[instance,_.get(instance,"base_share_class")]}).flatten(true).pluck("$loadPromise").filter().value();if(promises.length===0){return}$q.all(promises).then(function recurse(items){var time_series_array=_.filter(_.flatten([_.pluck(items,"returns_time_series"),_.pluck(items,["base_share_class","returns_time_series"]),_(items).pluck("funds").flatten().pluck(["base_share_class","returns_time_series"]).value()]));$scope.selectedId=_.contains($scope.state.timeframes,{id:Number($scope.selectedId)})&&$scope.selectedId||_($scope.state.timeframes).pluck("id").first()||0;var first_date=_(time_series_array).pluck("first_date").sortBy().first();$scope.state.maxMonths=moment().diff(first_date,"months");_.forEach($scope.state.timeframes,function(timeframe){timeframe.invalid=!$scope.events.isValid(timeframe)});if(_.get($scope,"state.selectedTimeframe.invalid")){$scope.state.selectedTimeframe=_.find($scope.state.timeframes,{invalid:false})||$scope.state.selectedTimeframe}})};$scope.$watch("selectedId",function(newVal,oldVal){if(Number(newVal)!=Number(oldVal)){$scope.state.selectedTimeframe=_.find($scope.state.timeframes,{id:Number($scope.selectedId)||0});$scope.selectedId=Number(_.get($scope.state.selectedTimeframe,"id"))||0}});$scope.$watchCollection("[fundgroupId, data.fundgroup.$$hashKey]",function(){if(!$scope.fundgroupId){return}FundGroup.load($scope.fundgroupId).$preloadPromise.then(function(fundgroup){$scope.data.fundgroup=fundgroup;$scope.items=fundgroup.funds||[]})});$scope.$watch("items",function(){$scope.reload()})}}});"use strict";angular.module("edgefolio.enterprise.widgets.timeseriesTable",["edgefolio.models"]).directive("edgefolioTimeseriesTable",function($q,$stateParams,ApiBaseClass,DateBucket,Fund,TimeSeries){return{restrict:"E",templateUrl:"/assets/whitelabel/enterprise/widgets/timeseriesTable/timeseriesTable.html",scope:{timeseriesId:"=",timeframeId:"=?"},controller:function($scope){$scope.state={loading:true,error:false,selected:{month:null,year:null}};$scope.data={months:[],years:[],timeseries:null,table:null};$scope.events={isNegative:function(value){return value<0}}},link:function($scope,element,attr){$scope.timeframeId=$scope.timeframeId||0;$scope.data.months=moment.monthsShort().concat("YTD");$scope.reload=function(){$scope.state.loading=true;TimeSeries.loadFromUuid($scope.timeseriesId,{timeframe_id:$scope.timeframeId}).then(function(timeseries){$scope.state.loading=false;$scope.state.error=!timeseries||_.all(timeseries,_.isNull);$scope.data.timeseries=timeseries;if(!timeseries){$scope.data.table={};$scope.data.years=[];$scope.state.error=true}else{$scope.data.table={};_.forIn($scope.data.timeseries,function(value,date){date=moment(date);_.set($scope.data.table,[date.year(),moment.monthsShort(date.month())],value)});_.forIn($scope.data.table,function(row,year){$scope.data.table[year]["YTD"]=_(row).values().reject(_.isNull).thru(TimeSeries.toCalc,TimeSeries).map(function(value){return value+1}).thru(ss.product).thru(function(value){return value-1}).thru(TimeSeries.fromCalc,TimeSeries).value()});$scope.data.years=_.keys($scope.data.table).sort().reverse();$scope.data.months=moment.monthsShort().concat("YTD")}})};$scope.$watchCollection("[timeframeId, timeseriesId]",function(){$scope.reload()})}}});"use strict";angular.module("edgefolio.enterprise.widgets.fundgroupMenu",["edgefolio.models"]).directive("edgefolioFundgroupMenu",function($q,$stateParams,FundGroup){return{restrict:"E",templateUrl:"/assets/whitelabel/enterprise/widgets/fundgroupMenu/fundgroupMenu.html",scope:{fundgroupId:"=",selectedFundId:"=?",hoverFundId:"=?",timeframeId:"=?",fundSref:"=?"},controller:function($scope){$scope.defaults={fundSref:"root.hedge-funds.profile"};$scope.state={loading:true,error:false};$scope.data={fundgroup:null,funds:[]};$scope.events={removeId:function(id){if($scope.data.fundgroup){$scope.data.fundgroup.$removeFundIds(id)}}}},link:function($scope,element,attr){$scope.$scope=$scope;$scope.reload=function(){$scope.state.loading=true;$scope.state.error=false;FundGroup.load($scope.fundgroupId,{silent:true}).$loadPromise.then(function(fundgroup){$scope.data.fundgroup=fundgroup;$scope.selectedFundId=_.contains(fundgroup.fund_ids,Number($scope.selectedFundId))?$scope.selectedFundId:_.first(fundgroup.fund_ids)||$scope.selectedFundId})["finally"](function(){$scope.state.loading=false;$scope.state.error=!_.size(_.get($scope,"data.fundgroup.funds"))})};$scope.$watchCollection("[fundgroupId, data.fundgroup.$$hashKey]",function(){if(!$scope.fundgroupId){return}$scope.reload()})}}});angular.module("edgefolio.models").factory("BaseWidget",function(){var BaseWidget=new JS.Class("BaseWidget",{restrict:"E",templateUrl:"/assets/whitelabel/enterprise/widgets/baseWidget/baseWidget.html",scope:{label:"@",items:"=?",selectedId:"=?"},initialize:function(options){var instance=this;instance.options=options;this.compile=function(element,attributes){return{pre:function(scope,element,attributes,controller,transcludeFn){scope.instance=instance;return instance.pre.call(instance,scope,element,attributes,controller,transcludeFn)},post:function(scope,element,attributes,controller,transcludeFn){return instance.post.call(instance,scope,element,attributes,controller,transcludeFn)}}}},pre:function(scope,element,attributes,controller,transcludeFn){console.log("baseWidget.js:25:pre","this, scope, element, attributes, controller, transcludeFn",this,scope,element,attributes,controller,transcludeFn)},post:function(scope,element,attributes,controller,transcludeFn){console.log("baseWidget.js:29:post","scope, element, attributes, controller, transcludeFn",scope,element,attributes,controller,transcludeFn)},extend:{init:function(options){return new this(options)}}});return BaseWidget});angular.module("edgefolio.models").directive("baseWidget",function(BaseWidget){var options={color:"red"};var directive=new BaseWidget(options);return directive});angular.module("edgefolio.models",["edgefolio.constants"]);angular.module("edgefolio.models").value("_",window._);angular.module("edgefolio.models").value("$",window.$);angular.module("edgefolio.models").value("JS",window.JS);angular.module("edgefolio.models").value("moment",window.moment);angular.module("edgefolio.models").value("kurtosis",require("compute-kurtosis"));angular.module("edgefolio.models").value("covariance",require("compute-covariance"));angular.module("edgefolio.models").factory("EventModule",function(JS,_){var EventModule=new JS.Module({$bindEvents:null,$bind:function(eventName,callback,context){this.$bindEvents=this.$bindEvents||{};this.$bindEvents[eventName]=this.$bindEvents[eventName]||[];if(!_.isFunction(callback)){console.error("EventModule::$bind(eventName, callback)","callback is not a function: ",eventName,callback);return}var bindEntry={callback:callback,context:context||this};if(!_.find(this.$bindEvents[eventName],function(loopBindEntry){return bindEntry.callback===loopBindEntry.callback&&bindEntry.context===loopBindEntry.context})){this.$bindEvents[eventName].push(bindEntry)}},$unbind:function(eventName,callback,context){this.$bindEvents=this.$bindEvents||{};this.$bindEvents[eventName]=this.$bindEvents[eventName]||[];if(callback||context){this.$bindEvents[eventName]=_.reject(this.$bindEvents[eventName],function(bindEntry){if(callback&&context){return bindEntry.callback===callback&&bindEntry.context===context}else if(callback&&!context){return bindEntry.callback===callback}else if(!callback&&context){return bindEntry.context===context}})}else{this.$bindEvents[eventName]=[]}},$trigger:function(eventName){this.$bindEvents=this.$bindEvents||{};this.$bindEvents[eventName]=this.$bindEvents[eventName]||[];var restArgs=[].slice.call(arguments,1);_.each(this.$bindEvents[eventName],function(bindEntry){bindEntry.callback.apply(bindEntry.context,restArgs)})}});return EventModule});angular.module("edgefolio.models").factory("CallbackPromise",function($q){function CallbackPromise(previousCallbackPromise){this.init(previousCallbackPromise)}CallbackPromise.prototype={klass:CallbackPromise,init:function(previousCallbackPromise){var self=this;this.deferred=$q.defer();this.status="unresolved";this.value={success:null,error:null};this.callbacks={success:[],error:[]};for(var key in this.deferred.promise){this[key]=this.deferred.promise[key]}if(previousCallbackPromise&&previousCallbackPromise.status==="unresolved"){this.then(function(){previousCallbackPromise.resolve(self);return previousCallbackPromise.then(function(){
return self})})}},callback:function(callback){if(typeof callback!=="function"){console.warn("CallbackPromise::callback(): callback not of type function",callback);return this}this.callbacks["success"].unshift(callback);this.executeCallbacks();return this},errorCallback:function(callback){if(typeof callback!=="function"){console.warn("CallbackPromise::onError(): callback not of type function",callback);return this}this.callbacks["error"].unshift(callback);this.executeCallbacks();return this},executeCallbacks:function(){if(this.status==="success"||this.status==="error"){var next_function;while(next_function=this.callbacks[this.status].pop()){next_function(this.value[this.status])}}},resolve:function(resolvedValue){this.status="success";this.value[this.status]=resolvedValue;this.executeCallbacks();return this.deferred.resolve(this.value[this.status])},reject:function(resolvedValue){this.status="error";this.value[this.status]=resolvedValue;this.executeCallbacks();return this.deferred.reject(this.value[this.status])}};return function(){return new CallbackPromise}});angular.module("edgefolio.models").factory("ApiFieldGenerator",function($injector){var AFG,ApiFieldGenerator;AFG=ApiFieldGenerator={klass:{unenumerableKlassPrototype:function(klass){klass=ApiFieldGenerator._getKlass(klass);for(var key in klass.prototype){Object.defineProperty(klass.prototype,key,{configurable:true,writable:true,enumerable:false,value:klass.prototype[key]})}return klass}},_call:function(context,functionOrValue,value){if(functionOrValue instanceof Function){return functionOrValue.call(context,value)}else{return functionOrValue!==undefined?functionOrValue:null}},_getKlass:function(klass){if(typeof klass==="string"){try{klass=$injector.get(klass)}catch(e){console.error("ApiFieldGenerator","$injector.get(",klass,") failed");return null}}return klass},_getId:function(value){if(typeof value==="number"||typeof value==="string"){return value}return value&&value.id||null},_convertSelectorToArray:function(field){return _.isArray(field)?_.flatten(field):String(field).split(".")},memoize:function(func){var cache={};var memoized=function(){var cacheArgs=[this].concat(_.values(arguments));var cacheKey=JSON.stringify(_.map(cacheArgs,AFG._memoizeCacheKey,AFG));if(typeof cache[cacheKey]==="undefined"){cache[cacheKey]=func.apply(this,arguments)}return cache[cacheKey]};memoized.cache=cache;return memoized},_memoizeCacheKey:function(item){if(_.isArray(item)){return _.map(item,AFG._memoizeCacheKey,AFG)}if(_.isNumber(item)){return item}if(_.isString(item)){return item}if(_.isObject(item)){if(item.$$hashkey){return item.$$hashkey}if(item.displayName){return item.displayName}if(item.klass){return String(item)}}return item},defineProperty:function(instance,field,descriptor,options){if(typeof options==="string"){options={generator:options}}options=_.extend({generator:"",priority:true,overwrite:false},options);if(instance&&instance.$fields&&options.generator){if(options.overwrite||options.priority&&_.get(instance.$fields,[options.generator,field])!==true||!options.priority&&_.get(instance.$fields,[options.generator,field])===undefined){ApiFieldGenerator._defineDeepProperty(instance,field,descriptor,options);for(var generatorKey in instance.$fields){if(instance.$fields[generatorKey][field]===true){instance.$fields[generatorKey][field]=false}}_.set(instance.$fields,_.flatten([options.generator,field]),true)}}else{ApiFieldGenerator._defineDeepProperty(instance,field,descriptor,options)}},_defineDeepProperty:function(instance,field,descriptor,options){descriptor=_.extend({enumerable:true,configurable:true},descriptor);var field_array_parent=AFG._convertSelectorToArray(field);var child_field=field_array_parent.pop();var parent_instance=instance;if(field_array_parent.length){if(!_.isObject(_.get(instance,field_array_parent))){_.set(instance,field_array_parent,{})}parent_instance=_.get(instance,field_array_parent)}Object.defineProperty(parent_instance,child_field,descriptor)},_defineDeepProperties:function(instance,descriptorHash,options){_.forIn(descriptorHash,function(descriptor,field){ApiFieldGenerator._defineDeepProperty(instance,field,descriptor,options)})},defineGetters:function(instance,methodHash,_callback,descriptor){if(_.isString(methodHash)){methodHash=_.set({},methodHash,_callback)}if(!_.isFunction(_callback)&&_.isObject(_callback)){descriptor=_callback;_callback=null}descriptor=_.extend({enumerable:true},descriptor);_.forIn(methodHash,function(callback,field){ApiFieldGenerator._defineDeepProperty(instance,field,_.extend({},descriptor,{configurable:true,get:function(){var output=null;if(_.isFunction(callback)){return callback.call(this)}return output}}))})},selfCaching:function(instance,methodHash,_callback,descriptor){if(_.isString(methodHash)){methodHash=_.set({},methodHash,_callback)}if(!_.isFunction(_callback)&&_.isObject(_callback)){descriptor=_callback;_callback=null}descriptor=_.extend({enumerable:true},descriptor);_.forIn(methodHash,function(callback,field){ApiFieldGenerator._defineDeepProperty(instance,field,_.extend({},descriptor,{configurable:true,get:function(){var output=null;if(_.isFunction(callback)){output=callback.call(this);if(output!==null){ApiFieldGenerator._defineDeepProperty(this,field,{configurable:true,enumerable:descriptor.enumerable,value:output})}}return output}}))})},static:function(instance,field,data){data=data||instance.$data;ApiFieldGenerator.defineProperty(instance,field,{enumerable:true,configurable:true,get:function(){return data[field]},set:function(value){data[field]=value}},{generator:"static",priority:false})},alias:function(instance,alias,field){field=AFG._convertSelectorToArray(field);ApiFieldGenerator.defineProperty(instance,alias,{enumerable:true,configurable:true,get:function(){return _.get(instance,field)},set:function(value){_.set(instance,field,value)}},{generator:"alias",priority:false})},aliasFunction:function(instance,alias,field,context){field=AFG._convertSelectorToArray(field);var field_string=field.join(".");if(field_string.match(/^[^()]+\(\)$/)){field=AFG._convertSelectorToArray(field_string.replace("()",""));ApiFieldGenerator.defineProperty(instance,alias,{enumerable:true,configurable:true,get:function(){context=(_.isString(context)?_.get(instance,context):context)||instance;var func=_.get(instance,field);return _.isFunction(func)?func.call(context):null}},{generator:"aliasFunction",priority:false})}else{ApiFieldGenerator.defineProperty(instance,alias,{enumerable:true,configurable:true,get:function(){context=(_.isString(context)?_.get(instance,context):context)||instance;return AFG._resolveFunctionChain(instance,field,context)}},{generator:"aliasFunction",priority:false})}},_resolveFunctionChain:function(instance,field,context){context=(_.isString(context)?_.get(instance,context):context)||instance;var original={field:field,context:context,instance:instance};var field_array=AFG._convertSelectorToArray(field);var output=instance;try{for(var i=0,n=field_array.length;i<n;i++){var child_field=field_array[i];var field_is_function=false;if(_.endsWith(child_field,"()")){child_field=child_field.replace("()","");field_is_function=true}if(output!==null&&output!==undefined){output=output[child_field]}else{console.error("ApiFieldGenerator::_resolveFunctionChain","unable to resolve chain",field_array.join("."),"at",child_field,original)}if(field_is_function){if(output&&_.isFunction(output)){output=output.call(context)}else{console.error("ApiFieldGenerator::_resolveFunctionChain",child_field+"() is not a function",output,"for",field_array.join("."),output,original);return null}}}}catch(exception){console.error("ApiFieldGenerator::_resolveFunctionChain","unable to resolve chain",field_array.join("."),"at",child_field,output,original,exception);return null}return output},objectAlias:function(instance,alias,fields){ApiFieldGenerator.defineProperty(instance,alias,{value:{}},{generator:"objectAlias",priority:false});_.each(fields,function(field){var field_array=AFG._convertSelectorToArray(field);var last_field=_.last(field_array);var object=_.get(instance,alias);ApiFieldGenerator._defineDeepProperty(object,last_field,{enumerable:true,configurable:true,get:function(){return _.get(instance,field_array)},set:function(value){_.set(instance,field_array,value)}})})},unCamelCase:function(instance,field){var data=instance.$data;ApiFieldGenerator.defineProperty(instance,field,{enumerable:true,configurable:true,get:function(){return String(data[field]||"").replace(/([a-z])([A-Z])/g,"$1 $2")},set:function(value){data[field]=String(value||"").replace(/\s+/g,"")||null}},{generator:"unCamelCase",priority:true})},join:function(instance,field,fields,seperator){var data=instance.$data;seperator=seperator||" ";ApiFieldGenerator.defineProperty(instance,field,{enumerable:true,configurable:true,get:function(){return _(instance).pick(fields).values().filter().join(seperator||" ")}},{generator:"join",priority:false})},lookupAlias:function(instance,alias,field,lookup){lookup=lookup||{};ApiFieldGenerator.defineProperty(instance,alias,{enumerable:true,configurable:true,get:function(){return lookup[instance[field]]||null},set:function(value){for(var key in lookup){if(lookup[key]==value){instance[field]=key;return}}instance[field]=null}},{generator:"lookup",priority:false})},lookupOverwrite:function(instance,field,lookup){var data=instance.$data;ApiFieldGenerator.defineProperty(instance,field,{enumerable:true,configurable:true,get:function(){return lookup[data[field]]||null},set:function(value){for(var key in lookup){if(lookup[key]==value){data[field]=key;return}}instance[field]=null}},{generator:"lookup",priority:true})},wrapClassReadOnly:function(instance,field,klass){klass=ApiFieldGenerator._getKlass(klass);var data=instance.$data;var cache=instance.$cache;ApiFieldGenerator.defineProperty(instance,field,{enumerable:true,configurable:true,get:function(){if(!cache[field]){cache[field]=new klass(data[field])}return cache[field]},set:function(value){if(value instanceof klass){cache[field]=value}else{cache[field]=new klass(value)}}},{wrapClass:"wrapClassReadOnly",priority:true})},wrapClassOverwrite:function(instance,field,klass){klass=ApiFieldGenerator._getKlass(klass);var data=instance.$data;ApiFieldGenerator.defineProperty(instance,field,{enumerable:true,configurable:true,get:function(){if(!(data[field]instanceof klass)){data[field]=new klass(data[field])}return data[field]},set:function(value){if(value instanceof klass){data[field]=value}else{data[field]=new klass(value)}}},{wrapClass:"wrapClassReadOnly",priority:true})},lazyLoadId:function(instance,field,klass){klass=ApiFieldGenerator._getKlass(klass);var id_field=field+"_id";var uuid_field=field+"_uuid";var cache=instance.$cache;ApiFieldGenerator.defineProperty(instance,id_field,{enumerable:true,configurable:true,get:function(){return this.$data[field]||null},set:function(value){this.$data[field]=value}},{generator:"lazyLoadId",priority:true});ApiFieldGenerator.defineProperty(instance,uuid_field,{enumerable:true,configurable:true,get:function(){return _.get(this[field],"uuid")||null}},{generator:"lazyLoadId",priority:true});ApiFieldGenerator.defineProperty(instance,field,{enumerable:true,configurable:true,get:function(){if(!this[id_field]){cache[field]=null}else if(!cache[field]||cache[field].id!=this[id_field]){cache[field]=klass.load(this[id_field])}return cache[field]||null},set:function(value){this[id_field]=ApiFieldGenerator._getId(value)}},{generator:"lazyLoadId",priority:true});if(instance[id_field]&&typeof instance[id_field]==="object"&&instance[id_field].id){var preloadedData=instance[id_field];instance[field]=klass.load({id:preloadedData.id,data:preloadedData,load:false,loaded:true})}},lazyLoadIdArray:function(instance,field,klass){klass=ApiFieldGenerator._getKlass(klass);var self=this;var cache=instance.$cache;var id_field=String(field).match(/ees$/)?String(field).replace(/s$/,"")+"_ids":String(field).replace(/e?s$/,"")+"_ids";var uuid_field=String(id_field).replace(/_ids$/,"_uuids");var index_field=String(id_field).replace(/_ids$/,"_index");ApiFieldGenerator.defineProperty(instance,id_field,{enumerable:true,configurable:true,get:function(){return this.$data[field]},set:function(value){this.$data[field]=value}},{generator:"lazyLoadIdArray",priority:true});instance[id_field]=instance[id_field]||[];ApiFieldGenerator.selfCaching(instance,uuid_field,function(){return _.pluck(this[field],"uuid")},{generator:"lazyLoadIdArray",priority:true});ApiFieldGenerator.defineProperty(instance,field,{enumerable:true,configurable:true,get:function(){var array_cache_key=[field,"[",String(instance[id_field]),"]"].join("");if(!cache[array_cache_key]){cache[array_cache_key]=_.map(instance[id_field],function(item){var id=Number(item&&item.id||item);return id&&klass.load(id)||null})}return cache[array_cache_key]},set:function(value){instance[id_field]=_(value).map(ApiFieldGenerator._getId).filter().value()}},{generator:"lazyLoadIdArray",priority:true});ApiFieldGenerator.defineProperty(instance,index_field,{enumerable:true,configurable:true,get:function(){var hash_cache_key=[field,"<",String(instance[id_field]),">"].join("");if(!cache[hash_cache_key]){cache[hash_cache_key]={};_.each(instance[id_field],function(item){var id=item&&typeof item==="object"?item.id:Number(item)||null;Object.defineProperty(cache[hash_cache_key],id,{enumerable:true,configurable:true,get:function(){return klass.cache[id]||klass.load(id)||null},set:function(value){var new_id=ApiFieldGenerator._getId(value);if(id&&new_id&&id!=new_id&&instance[id_field].indexOf(id)!==-1){instance[id_field].splice(instance[id_field].indexOf(id),1,new_id)}}})})}return cache[hash_cache_key]},set:function(value){instance[id_field]=_(value).map(ApiFieldGenerator._getId).filter().value()}},"lazyLoadIdArray");_.each(instance[id_field],function(preloadedData,index){if(typeof preloadedData==="object"){var id=Number(preloadedData.id);if(id){klass.load({id:id,data:preloadedData,load:false,loaded:true})}instance[id_field][index]=id}})}};return ApiFieldGenerator});angular.module("edgefolio.models").factory("ApiCache",function(){return{}});angular.module("edgefolio.models").factory("Edgefolio",function(){return{}});angular.module("edgefolio.models").run(function($injector,$rootScope,$window,Edgefolio,ApiFieldGenerator){$window.Edgefolio=Edgefolio;$rootScope.Edgefolio=Edgefolio;var classNames=["ApiCache","ApiFieldGenerator","CallbackPromise","ApiBaseClass","User","Company","ManagementCompany","InvestmentCompany","ServiceProvider","Fund","ShareClass","Person","Manager","Investor","DateBucket","TimeSeries","ApiCollection","Indexes","Benchmarks","Index","FundGroups","FundGroup"];for(var i in classNames){$rootScope[classNames[i]]=Edgefolio[classNames[i]]||ApiFieldGenerator._getKlass(classNames[i])}});angular.module("edgefolio.models").factory("UnenumerablePrototype",function(ApiFieldGenerator){var UnenumerablePrototype=new JS.Class("UnenumerablePrototype",{initialize:function(){var self=this},extend:{resolve:function(){this.callSuper();ApiFieldGenerator.klass.unenumerableKlassPrototype(this)},define:function(name,callable,options){var _callable=function(){Object.defineProperty(this,"callSuper",{enumerable:false,configurable:true,writable:true});return callable.apply(this,arguments)};return this.callSuper(name,_callable,options)}}});return UnenumerablePrototype});angular.module("edgefolio.models").factory("UnenumerableApiBaseClass",function(ApiBaseClass,ApiFieldGenerator){var UnenumerableApiBaseClass=new JS.Class("UnenumerableApiBaseClass",ApiBaseClass,{$reload:function(){console.error("@broken - UnenumerableApiBaseClass does not make instance variables unenumerable");this.callSuper();var self=this;_(this).omit(_.isFunction).keys().sortBy().each(function(key){Object.defineProperty(self,key,{enumerable:false,configurable:true,writable:true})})},extend:{resolve:function(){this.callSuper();ApiFieldGenerator.klass.unenumerableKlassPrototype(this)},define:function(name,callable,options){var _callable=function(){Object.defineProperty(this,"callSuper",{enumerable:false,configurable:true,writable:true});return callable.apply(this,arguments)};return this.callSuper(name,_callable,options)}}});return UnenumerableApiBaseClass});angular.module("edgefolio.models").factory("ApiBaseClass",function($injector,$q,$http,$cacheFactory,Edgefolio,ApiCache,ApiFieldGenerator,CallbackPromise,EventModule){var anonClassSetNameCounter=1;var ApiBaseClass=new JS.Class("ApiBaseClass",{include:EventModule,uuid:null,$$hashKey:null,$options:null,$dataVersion:null,$data:null,$cache:null,$fields:null,$loadPromise:null,$loaded:false,initialize:function(id,config){if(!config&&typeof id==="number"&&this.klass.cache[id]){return this.klass.cache[id]}this.$options=this.klass.parseOptions(id,config);this.id=this.$options.id;if(this.klass.cache[this.id]){if(this.$options.data){this.klass.cache[this.id].$setData(this.$options.$data)}if(this.$options.force){this.klass.cache[this.id].$reload({force:this.$options.force,load:this.$options.force})}return this.klass.cache[this.id]}else{this.klass.cache[this.id]=this}this.$loaded=!!this.$loaded;this.$dataVersion=this.$dataVersion||0;this.uuid=[this.klass.displayName,this.id].join(":");this.$$hashKey=[this.klass.displayName,this.id,this.$dataVersion].join(":");this.$data={};this.$cache={};this.$fields={};this.$reload(_.extend({force:false,load:true},this.$options))},$reload:function(options){options=options||{};options={force:options.force,load:options.load,loaded:options.loaded,data:options.data};this.$options=_.extend(this.$options,options);this.$initializeLoadPromise();this.$initializePreloadPromise();this.$setData(options.data);if(options.load!==false){this.$loadData(options)}if(options.loaded){this.$loadPromise.resolve(this)}return this.$loadPromise},$initializeLoadPromise:function(){var self=this;this.$loadPromise=CallbackPromise(this.$loadPromise||null);this.$loadPromise.callback(function(){self.$loaded=true})},$initializePreloadPromise:function(){this.klass.ApiFieldGenerator.defineGetters(this,{$preloadPromise:function(){return $q.when(this.$loadPromise)}})},$initializeObjectProperties:function(){for(var field in this.$data){this.klass.ApiFieldGenerator["static"](this,field,this.$data)}this.klass.ApiFieldGenerator.aliasFunction(this,"url","$getUrl()")},$deleteFromApi:function(){var self=this;this.$invalidateCache();return $http({method:"DELETE",url:this.$getUrl()}).then(function(){self.$trigger("destroy",this);delete self.klass.cache[self.id];return self})},$getUrl:function(){return this.klass.getUrl(this.id)},$setData:function(data){if(!_.isObject(this.$data)){this.$data={}}if(_.isObject(data)){this.$dataVersion=this.$dataVersion+1;this.$$hashKey=[this.klass.displayName,this.id,this.$dataVersion].join(":");this.$data=data}this.$initializeObjectProperties();this.$trigger("$setData",this)},$loadData:function(options){var self=this;return this.$fetchData(options).then(function(responseData){self.$setData(responseData);return self.$loadPromise.resolve(self)})["catch"](function(response){return self.$loadPromise.reject(response)})},$fetchData:function(options){var self=this;options=_.extend({url:this.$getUrl(),silent:false,force:false},this.$options,options);if(options.force){this.$invalidateCache(options.url)}return $http.get(options.url,{cache:true}).then(function(response){if(!response.data||response.status>=400){options.silent||console.error(self.klass.displayName,"::$fetchData() invalid response: ",options.url,response);return $q.reject(response)}else{return response.data}})},$invalidateCache:function(url){url=url||this.$getUrl();var path=url.replace(new RegExp("^https?://[^/]+/"),"/");$cacheFactory.get("$http").remove(path)},toString:function(){return this.$$hashKey},toJSON:function(){return JSON.stringify(this.$data)},toObject:function(){return _.clone(this)},extend:{url:null,idParam:null,cache:{},ApiFieldGenerator:ApiFieldGenerator,defaultOptions:{id:null,data:null,load:true,silent:false},setName:function(name){name=this.displayName||name||"AnonClass-"+anonClassSetNameCounter++;return this.callSuper(name)},resolve:function(){this.cache=ApiCache[this.displayName]=ApiCache[this.displayName]||{};Edgefolio[this.displayName]=Edgefolio[this.displayName]||this;return this.callSuper()},load:function(id,config){if(!config&&!_.isObject(id)&&this.cache[id]){return this.cache[id]}return new this(id,config)},toUuid:function(uuid){if(_.isNull(uuid)&&_.isUndefined(uuid)){return null}if(_.isArray(uuid)&&_.isFinite(Number(uuid[1]))){return uuid.join(":")}if(_.isString(uuid)&&_.contains(uuid,":")){return uuid}if(uuid&&uuid.uuid){return uuid.uuid}else{if(this.idParam){var options=this.parseOptions(uuid,{silent:true});return options.id&&[this.displayName,options.id].join(":")||null}else{return this.displayName+":"}}},toUuids:ApiFieldGenerator.memoize(function(ids){var output=_.map(ids,this.toUuid,this);this.cache.toUuids=this.cache.toUuids||{};this.cache.toUuids[output]=this.cache.toUuids[output]||output;return this.cache.toUuids[output]}),loadUuid:function(uuid,defaultClass){var id,klass;if(uuid&&uuid.klass){return uuid}defaultClass=defaultClass||this;uuid=_.isArray(uuid)?uuid:String(uuid).split(":");if(!_.isNaN(Number(uuid[0]))){klass=defaultClass;id=Number(uuid[0])}else{klass=uuid[0];id=Number(uuid[1])}if(!id){return null}if(_.isString(klass)){klass=ApiFieldGenerator._getKlass(klass)}if(klass&&klass.load){if(!klass.idParam){return klass.load(null)}else{return id&&klass.load(id)||null}}else{console.error("ApiBaseClass.loadUuid(",uuid,defaultClass,") - unable to parse options");return null}},parseOptions:function(id,config){config=config||{};var options=_.extend({},this.defaultOptions,{load:!(_.get(id,"data")||_.get(config,"data")),loaded:!!(_.get(id,"data")||_.get(config,"data"))},config);if(typeof id==="number"||typeof id=="string"){options.id=id}else if(typeof id==="object"){options=_.extend(options,id)}options.id=options.id||this.idParam&&options[this.idParam]||options.stateParams&&options.stateParams[this.idParam]||null;if(options.id instanceof Function){options.id=options.id.call(this)}if(typeof options.id==="string"&&options.id.match(/^\d+$/)){options.id=Number(options.id)}options[this.idParam]=options.id||null;delete options.stateParams;return options},validateClass:function(){var isValid=true;if(typeof this.url!=="string"){console.warn(this.displayName,"::load() - invalid this.url: ",this);isValid=false}if(typeof this.idParam!=="string"){console.warn(this.displayName,"::load() - invalid this.idParam: ",this);isValid=false}return isValid},getUrl:function(id,config){var options=this.parseOptions(id,config);var url=String(this.url||"");if(this.idParam&&options.id){url=url.replace(new RegExp(":"+this.idParam,"g"),options.id)}return url},getIndexUrl:function(){return String(this.url||"").replace(new RegExp(":"+this.idParam+"/*","g"),"")}}});return ApiBaseClass});angular.module("edgefolio.models").factory("Fund",function($q,ApiBaseClass,CountryCodes,LegalStructures,TimeSeries,Index,CurrencySymbolMap){var Fund=new JS.Class("Fund",ApiBaseClass,{extend:{url:"/api/funds/:fund_id/",idParam:"fund_id",risk_free_index_id:63304},$reload:function(){this.callSuper();return this.$loadPromise.then(function(fund){$q.all(_.pluck(fund.share_classes,"$loadPromise")).then(function(){fund.share_classes=_.sortBy(fund.share_classes,function(share_class){return-_.size(share_class.returns_time_series)});fund.base_share_class=_.first(fund.share_classes)}).then(function(){if(fund.risk_free_index){return fund.risk_free_index.$loadPromise}}).then(function(){return fund})})},$initializePreloadPromise:function(){this.klass.ApiFieldGenerator.defineGetters(this,{$preloadPromise:function(){var self=this;return $q.when(self.$loadPromise).then(function(){var promises=_([self.management_company,self.share_classes,self.service_providers,self.managers,self.category_benchmark_index,self.asset_class_benchmark_index,self.prospectus_benchmark_index,self.risk_free_index]).flatten().pluck("$loadPromise").reject(_.isNull).map(function(promise){return $q.when(promise)["catch"](_.noop)}).value();return $q.all(promises).then(function(){return self})})}})},$setData:function(data){if(_.isObject(data)){data=_.extend({risk_free_index:this.klass.risk_free_index_id},data)}return this.callSuper(data)},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.lazyLoadId(this,"management_company","ManagementCompany");this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"share_classes","ShareClass");this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"service_providers","ServiceProvider");this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"managers","Manager");this.klass.ApiFieldGenerator.lookupOverwrite(this,"legal_structure",LegalStructures);this.klass.ApiFieldGenerator.wrapClassOverwrite(this,"aum_time_series","TimeSeries");this.klass.ApiFieldGenerator.lazyLoadId(this,"category_benchmark_index","Index");this.klass.ApiFieldGenerator.lazyLoadId(this,"asset_class_benchmark_index","Index");this.klass.ApiFieldGenerator.lazyLoadId(this,"prospectus_benchmark_index","Index");this.klass.ApiFieldGenerator.lazyLoadId(this,"risk_free_index","Index");this.klass.ApiFieldGenerator.alias(this,"latest_aum.amount","aum_time_series.latest","aum_time_series");this.klass.ApiFieldGenerator.alias(this,"latest_aum.currency","aum_series_currency");this.klass.ApiFieldGenerator.alias(this,"latest_aum.date","aum_time_series.latest_date","aum_time_series");this.klass.ApiFieldGenerator.lookupAlias(this,"latest_aum.symbol","aum_series_currency",CurrencySymbolMap);this.klass.ApiFieldGenerator.lookupOverwrite(this,"domicile_country",CountryCodes);this.klass.ApiFieldGenerator.lookupAlias(this,"domicile_country_code","domicile_country");this.klass.ApiFieldGenerator.objectAlias(this,"investors_breakdown",["sovereign_wealth","pension_funds","foundations_and_endowments","consultants","family_offices","funds_of_funds","managed_account_platforms","seeders_and_accelerators","high_net_worth_individuals","internal","number_of_investors"])},$isValidForTimeframeId:function(timeframe_id){if(this.base_share_class){return this.base_share_class.$isValidForTimeframeId(timeframe_id)}else{return false}},$statistics:function(options){options=_.extend({share_class_id:_.get(this,"base_share_class.id")||null,risk_free_index:this.risk_free_index||null},options);return TimeSeries.statistics(options)}});return Fund});angular.module("edgefolio.models").factory("Index",function(ApiBaseClass){var Index=new JS.Class("Index",ApiBaseClass,{extend:{url:"/api/indexes/:index_id/",idParam:"index_id"},$initializeObjectProperties:function(){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.wrapClassOverwrite(this,"returns_time_series","TimeSeries")},$statistics:function(options){return this.returns_time_series.$statistics(options)}});return Index});angular.module("edgefolio.models").factory("Person",function(ApiBaseClass){var Person=new JS.Class("Person",ApiBaseClass,{$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.join(this,"full_name",["first_name","middle_name","last_name"])}});return Person});angular.module("edgefolio.models").factory("Manager",function(ApiBaseClass,Person){var Manager=new JS.Class("Manager",Person,{extend:{url:"/api/managers/:manager_id/",idParam:"manager_id"},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.lazyLoadId(this,"management_company","ManagementCompany")}});return Manager});angular.module("edgefolio.models").factory("Investor",function(ApiBaseClass,Person){var Investor=new JS.Class("Investor",Person,{extend:{url:"/api/investors/:investor_id/",idParam:"investor_id"},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.lazyLoadId(this,"investment_company","InvestmentCompany")}});return Investor});angular.module("edgefolio.models").factory("ShareClass",function($q,ApiBaseClass,Fund,Benchmarks,Index,TimeSeries,TimeframeDefinitions){var ShareClass=new JS.Class("ShareClass",ApiBaseClass,{$initializeObjectProperties:function(data){var self=this;this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.lazyLoadId(this,"fund","Fund");this.klass.ApiFieldGenerator.wrapClassOverwrite(this,"returns_time_series",TimeSeries);this.klass.ApiFieldGenerator.alias(this,"max_timeframe_id","returns_time_series.max_timeframe_id","amount");this.klass.ApiFieldGenerator.defineGetters(this,"time_periods",function(){return _(TimeframeDefinitions).filter(function(timeframe){if(timeframe.id===0){return true}if(this.max_timeframe_id===0){return false}if(timeframe.id<=this.max_timeframe_id){return true}else{return false}},this).cloneDeep()});this.$loadPromise.then(function(){return Benchmarks.load().$loadPromise.then(function(benchmark){self.benchmarks=benchmark.results})})},$isValidForTimeframeId:function(timeframe_id){timeframe_id=Number(timeframe_id&&timeframe_id.id||timeframe_id)||0;if(timeframe_id===0){return true}if(this.max_timeframe_id===0){return false}if(timeframe_id<=this.max_timeframe_id){return true}else{return false}},$statistics:function(options){options=_.extend({share_class:this,risk_free_index:_.get(this,"fund.risk_free_index")||null},options);return TimeSeries.statistics(options)},loadCombinedReturnsPlotData:function(options){return this.klass.loadCombinedReturnsPlotData(_.extend({share_class_id:this.id},options))},extend:{url:"/api/share-classes/:share_class_id/",idParam:"share_class_id",loadCombinedReturnsPlotData:function(options){var self=this;options=_.extend({fund_id:null,share_class_id:null,benchmark_id:null,timeframe_id:null},options);var loaded={};if(options.fund_id){Fund.load(options.fund_id)}if(options.share_class_id){ShareClass.load(options.share_class_id)}if(options.benchmark_id){Index.load(options.benchmark_id)}return Benchmarks.load().$loadPromise.then(function(benchmarks){options.benchmark_id=options.benchmark_id||_.get(benchmarks,["results",0,"id"]);loaded.benchmarks=benchmarks;loaded.benchmark=Index.load(options.benchmark_id);return loaded.benchmark.$loadPromise}).then(function(){if(options.fund_id&&!options.share_class_id){return Fund.load(options.fund_id).$loadPromise.then(function(fund){options.share_class_id=_.get(fund,["base_share_class","id"])})}}).then(function(){if(!options.share_class_id){return $q.reject(options)}loaded.shareClass=ShareClass.load(options.share_class_id);return loaded.shareClass.$loadPromise}).then(function(){loaded.timeseries=loaded.shareClass.returns_time_series;loaded.fund=loaded.shareClass.fund;return loaded.fund.$loadPromise}).then(function(){options.timeframe_id=options.timeframe_id&&Math.min(options.timeframe_id,loaded.timeseries.max_timeframe_id)||loaded.timeseries.max_timeframe_id||0}).then(function(){loaded.timeseries=loaded.timeseries.timeframe(options.timeframe_id);loaded.benchmark_returns=loaded.benchmark.returns_time_series.timeframe(options.timeframe_id);loaded.aum_time_series=loaded.fund.aum_time_series.timeframe(options.timeframe_id);var combined_returns=TimeSeries.groupByDateObject(loaded.timeseries,loaded.benchmark_returns,loaded.aum_time_series);var timeseries_returns=_(combined_returns).pluck(0).map(function(value){return value||0}).value();var benchmark_returns=_(combined_returns).pluck(1).map(function(value){return value||0}).value();var aum_time_series=_(combined_returns).mapKeys(function(value,key){var match=key.match(/^\d{4}-\d{2}-\d{2}/);if(match){return match[0]}else{return moment(key).format("YYYY-MM-DD")}}).mapValues(function(array,key){return _.isFinite(array[2])?array[2]:null}).value();var timeseries_compounded=_.values(TimeSeries.toCompounded(timeseries_returns,1e3));var benchmark_compounded=_.values(TimeSeries.toCompounded(benchmark_returns,1e3));var dates=_.keys(aum_time_series);var combined_returns_plot_data={aum_time_series:aum_time_series,
fund:{performance:timeseries_returns,compounded:timeseries_compounded},benchmark:{name:loaded.benchmark.name,performance:benchmark_returns,compounded:benchmark_compounded},timeframe:dates,perfmin:_([timeseries_returns,benchmark_returns]).flatten(true).min(),perfmax:_([timeseries_returns,benchmark_returns]).flatten(true).max(),comp_min:_([timeseries_compounded,benchmark_compounded]).flatten(true).min(),comp_max:_([timeseries_compounded,benchmark_compounded]).flatten(true).max(),perfunit:"%",compunit:_.get(loaded,"fund.latest_aum.symbol")||"$"};return combined_returns_plot_data})["catch"](function(){return $q.reject(options)})},loadComputedMeasure:function(options){var self=this;options=_.extend({fund_id:null,share_class_id:null,benchmark_id:null,timeframe_id:null},options);return $q.when().then(function(){if(options.fund_id&&!options.share_class_id){return Fund.load(options.fund_id).$loadPromise.then(function(fund){options.share_class_id=_.get(fund,["base_share_class","id"]);return fund})}else{return $q.when()}}).then(function(){if(!options.share_class_id){return $q.reject(options)}return $q.all({share_class:ShareClass.load(options.share_class_id).$loadPromise,benchmarks:Benchmarks.load().$loadPromise})}).then(function(loaded){options.benchmark_id=options.benchmark_id||_.get(loaded.benchmarks,["results",0,"id"]);return $q.all({benchmarks:loaded.benchmarks.$loadPromise,share_class:loaded.share_class.$loadPromise,fund:loaded.share_class.fund.$loadPromise,benchmark:Index.load(options.benchmark_id).$loadPromise,combined_returns_plot_data:ShareClass.loadCombinedReturnsPlotData({share_class_id:options.share_class_id,benchmark_id:options.benchmark_id,timeframe_id:options.timeframe_id})})}).then(function(loaded){var computedMeasure={};computedMeasure=_.extend(computedMeasure,loaded.share_class.$statistics(options));computedMeasure=_.extend(computedMeasure,_.mapKeys(loaded.benchmark.returns_time_series.$statistics(options),function(value,key){return"benchmark_"+key}));computedMeasure=_.extend(computedMeasure,{time_period:options.timeframe_id,track_record_years:options.timeframe_id/12||0,combined_returns_plot_data:loaded.combined_returns_plot_data,risk_free_index:loaded.fund.risk_free_index,benchmark:loaded.benchmark,hedge_fund:loaded.fund,share_class:loaded.share_class});return computedMeasure})["catch"](function(error){!options.silent&&console.error("ShareClass.js::loadComputedMeasure()",options,error)})},loadAnalysisData:function(options){return $q.when({aggregations:{beta:{values:{"5.0":-.011378890077979346,"25.0":.2590640709270656,"50.0":.5568018295490429,"75.0":.8321122521671087,"95.0":1.2065789034873509}},annualized_volatility:{values:{"5.0":4.386722419896362,"25.0":9.503835341720041,"50.0":14.216886028397294,"75.0":17.884822318333182,"95.0":29.2080784069086}},skewness_risk:{values:{"5.0":-1.255198823976933,"25.0":-.7420517278702031,"50.0":-.26548084380863624,"75.0":.1712817184033512,"95.0":1.2597839582770636}},annualized_sharpe_ratio:{values:{"5.0":-.1704695494927714,"25.0":.13384837976899072,"50.0":.38241910324157596,"75.0":.667940016074366,"95.0":1.0674025733710664}},annualized_compounded_excess_return:{values:{"5.0":-9.97300542023482,"25.0":-5.290055477238276,"50.0":-2.6815142348382173,"75.0":.799480525493157,"95.0":4.875374769528348}},annualized_compounded_return:{values:{"5.0":-3.7821643427842613,"25.0":1.8300789909024118,"50.0":5.043230306275348,"75.0":8.388993722755039,"95.0":13.901157973562539}},correlation_coefficient:{values:{"5.0":-2.362587387422491,"25.0":37.36150149594646,"50.0":57.97168974212245,"75.0":73.18781080572623,"95.0":86.90926969406661}},expected_return:{values:{"5.0":-.15179075630252098,"25.0":.28697943600517134,"50.0":.4844944957983194,"75.0":.8162653508771929,"95.0":1.3412492690058482}},annualized_alpha:{values:{"5.0":-7.778369685812743,"25.0":-1.6764362401012405,"50.0":1.3556088111789848,"75.0":5.223031583446895,"95.0":11.150750952759141}},kurtosis_risk:{values:{"5.0":-.057336449316577776,"25.0":1.074393791431112,"50.0":2.2758422924742976,"75.0":4.198839976473933,"95.0":11.360218777410434}},maximum_drawdown:{values:{"5.0":-73.34988797955162,"25.0":-52.276863409493835,"50.0":-31.70667554825193,"75.0":-21.337774698939036,"95.0":-6.1956574700649485}},annualized_sortino_ratio:{values:{"5.0":-.23078307230783285,"25.0":.1892764198964992,"50.0":.5300898471923283,"75.0":.9312279495393041,"95.0":1.952475164398659}}}})},getAnalysisData:function(options){var self=this;options=_.extend({percents:[0,25,50,75,100],timeframe:null,benchmark:null,hedgeFunds:null,sort:null,size:0},options);var promises=_.map(options.hedgeFunds,function(fund_id){var config={fund_id:_.isFinite(Number(fund_id))?Number(fund_id):_.get(fund_id,"id"),percents:options.percents,benchmark_id:options.benchmark_id||_.isFinite(Number(options.benchmark))?Number(options.benchmark):_.get(options.benchmark,"id"),timeframe_id:options.timeframe_id||_.isFinite(Number(options.timeframe))?Number(options.timeframe):_.get(options.timeframe,"id"),silent:true};return self.loadComputedMeasure(config)["catch"](_.noop)});return $q.all(promises).then(function(computedMeasures){computedMeasures=_.filter(computedMeasures);var computedMeasureDates=_(computedMeasures).pluck("combined_returns_plot_data.timeframe").flatten().unique().sortBy().value();_(computedMeasures).value().forEach(function(fund){_.each(["combined_returns_plot_data.fund.performance","combined_returns_plot_data.fund.compounded","combined_returns_plot_data.benchmark.performance","combined_returns_plot_data.benchmark.compounded"],function(arrayKey){var timeseriesInputArray=_.get(fund,arrayKey);var timeframes=_.get(fund,"combined_returns_plot_data.timeframe");var lastValue=_.contains(arrayKey,"compounded")?1e3:0;var timeseriesOutputArray=_(computedMeasureDates).indexBy().mapValues(function(dateString){var index=_.indexOf(timeframes,dateString);var output;if(index!==-1&&_.isFinite(timeseriesInputArray[index])){output=timeseriesInputArray[index]}else{output=lastValue}lastValue=output;return output}).values().value();_.set(fund,arrayKey,timeseriesOutputArray)});_.set(fund,"combined_returns_plot_data.timeframe",computedMeasureDates)});if(options.sort){if(options.sort.name){computedMeasures=_.sortBy(computedMeasures,options.sort.name)}if(options.sort.desc){computedMeasures=Array.reverse(computedMeasures)}}if(options.size){computedMeasures=_.take(computedMeasures,options.size)}computedMeasures=_.map(computedMeasures,function(computedMeasure){return{_id:computedMeasure.id,_index:null,_score:0,_type:"computed-measures",_source:computedMeasure}});return{hits:{hits:computedMeasures}}})}}});return ShareClass});angular.module("edgefolio.models").factory("User",function(ApiBaseClass){var User=new JS.Class("User",ApiBaseClass,{extend:{url:"/api/user/",idParam:null},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments)}});return User});angular.module("edgefolio.models").factory("Company",function(ApiBaseClass,CountryCodes){var Company=new JS.Class("Company",ApiBaseClass,{extend:{},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.objectAlias(this,"contact_information",["address_line_1","address_line_2","postal_code","city","country_code","province","latitude","longitude","phone","fax","email","homepage"]);this.klass.ApiFieldGenerator.lookupAlias(this,"country","country_code",CountryCodes);this.klass.ApiFieldGenerator.join(this,"address",["address_line_1","address_line_2","city","postal_code","country","province"],", ")}});return Company});angular.module("edgefolio.models").factory("ManagementCompany",function(ApiBaseClass,Company){var ManagementCompany=new JS.Class("ManagementCompany",Company,{extend:{url:"/api/management-companies/:management_company_id/",idParam:"management_company_id"},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"funds","Fund");this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"employees","Manager")}});return ManagementCompany});angular.module("edgefolio.models").factory("InvestmentCompany",function(ApiBaseClass,Company){var InvestmentCompany=new JS.Class("InvestmentCompany",Company,{extend:{url:"/api/investment-companies/:investment_company_id/",idParam:"investment_company_id"},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"employees","Investor")}});return InvestmentCompany});angular.module("edgefolio.models").factory("ServiceProvider",function(ApiBaseClass,Company){var ServiceProvider=new JS.Class("ServiceProvider",Company,{extend:{url:"/api/service-providers/:service_provider_id/",idParam:"service_provider_id"},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"funds","Fund");this.klass.ApiFieldGenerator.unCamelCase(this,"provider_kind")}});return ServiceProvider});angular.module("edgefolio.models").factory("ApiCollection",function($q,$timeout,$rootScope,$http,ApiBaseClass){var ApiCollection=new JS.Class("ApiCollection",ApiBaseClass,{extend:{url:"",idParam:null,resultsKlass:null},$initializeObjectProperties:function(){this.callSuper();if(this.klass.resultsKlass){this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"results",this.klass.resultsKlass)}},$fetchData:function(options){var callSuper=this.callSuper;var baseUrl=this.$getUrl();var outputData={};return this.callSuper(options).then(function(responseData){responseData.results=_.isArray(responseData.results)?responseData.results:[];outputData=responseData;if(responseData.results.length===0||responseData.results.length>=outputData.count){return outputData}else{var numberOfPages=_.ceil(outputData.count/responseData.results.length);var fetchAllPromise=_(2).range(numberOfPages+1).map(function(pageNumber){return callSuper(_.extend({},options,{url:baseUrl+"?page="+pageNumber}))}).thru(function(promises){return $q.all(promises)}).value();return fetchAllPromise.then(function(responseDataArray){_.each(responseDataArray,function(data){outputData.results=outputData.results.concat(data.results)});return outputData})}})},$addToCollection:function(itemData){var self=this;this.$invalidateCache(this.$getUrl());return $http({method:"POST",url:this.$getUrl(),data:itemData}).then(function(response){if(!response.data||response.status>=400){return $q.reject(response)}else{self.klass.resultsKlass.load(response.data.id,{data:response.data});if(!_.contains(self.result_ids,response.data.id)){self.$data.results.push(response.data.id);self.$setData(self.$data)}return self.klass.resultsKlass.load(response.data.id)}})},$removeFromCollection:function(itemOrId){var id=itemOrId&&itemOrId.id||itemOrId;if(_.contains(this.$data.results,id)){_.pull(this.$data.results,id);this.$setData(this.$data)}else{var data_item=_.find(this.$data.results,{id:id})||null;if(data_item&&_.contains(this.$data.results,data_item)){_.pull(this.$data.results,data_item);this.$setData(this.$data)}}},$deleteFromCollection:function(itemOrId){var self=this;return this.klass.resultsKlass.load(itemOrId,{load:false}).$deleteFromApi().then(function(item){self.$removeFromCollection(item)})}});return ApiCollection});angular.module("edgefolio.models").factory("Indexes",function(ApiCollection,Index){var Indexes=new JS.Class("Indexes",ApiCollection,{extend:{url:"/api/indexes/",idParam:null,resultsKlass:Index}});return Indexes});angular.module("edgefolio.models").factory("Benchmarks",function(ApiCollection,Indexes,Index){var Benchmarks=new JS.Class("Benchmarks",Indexes,{extend:{url:"/api/indexes/",idParam:null,resultsKlass:Index}});return Benchmarks});angular.module("edgefolio.models").factory("FundGroups",function($q,$http,ApiCollection,FundGroup){var FundGroups=new JS.Class("FundGroups",ApiCollection,{extend:{url:"/api/user/fund-groups/",idParam:null,resultsKlass:FundGroup}});return FundGroups});angular.module("edgefolio.models").factory("FundGroup",function($q,$http,ApiBaseClass){var FundGroup=new JS.Class("FundGroup",ApiBaseClass,{extend:{url:"/api/user/fund-groups/:fundgroup_id/",idParam:"fundgroup_id"},$initializeObjectProperties:function(data){this.callSuper.apply(this,arguments);this.klass.ApiFieldGenerator.lazyLoadIdArray(this,"funds","Fund")},$initializePreloadPromise:function(){this.klass.ApiFieldGenerator.defineGetters(this,{$preloadPromise:function(){var self=this;return $q.when(self.$loadPromise).then(function(){var promises=_([self.funds]).flatten().pluck("$loadPromise").reject(_.isNull).map(function(promise){return $q.when(promise)["catch"](_.noop)}).value();return $q.all(promises).then(function(){return self})})}})},$patchFundIds:function(fund_ids){var self=this;this.$invalidateCache(this.$getUrl());return $http({method:"PATCH",url:this.$getUrl(),data:{funds:_([fund_ids]).flatten(true).filter().map(String).unique().value()}}).then(function(response){if(!response.data||response.status>=400){return $q.reject(response)}else{self.$setData(response.data)}}).then(function(){return self})},$addFundIds:function(id){return this.$patchFundIds(_.flatten([this.fund_ids,Number(id)]))},$removeFundIds:function(id){return this.$patchFundIds(_.without(this.fund_ids,Number(id)))}});return FundGroup});angular.module("edgefolio.models").factory("DateBucketCache",function(){return{getKey:{},dateBucket:{},incrementDate:{}}});angular.module("edgefolio.models").factory("DateBucket",function(_,$q,ApiBaseClass,ApiFieldGenerator,UnenumerablePrototype,DateBucketCache,moment){var DateBucket=new JS.Class("DateBucket",UnenumerablePrototype,{initialize:function(timestamp_indexed_object,options){options=_.extend({prevalidated:false},options);if(options.prevalidated){this._setAllFromObjectPrevalidated(timestamp_indexed_object)}else{this._setAllFromObject(timestamp_indexed_object)}},$initializeObjectProperties:function(){ApiFieldGenerator.selfCaching(this,{latest:this.$latest,latest_date:this.$latest_date,first:this.$first,first_date:this.$first_date,max_timeframe_id:this.$max_timeframe_id},{enumerable:false,configurable:false})},has:function(date){return _.has(this,this.getKey(date))},getKey:function(date){var cache=DateBucketCache["getKey"];var cache_key=date instanceof moment?Number(date):date;if(!cache[cache_key]){cache[cache_key]=this.klass.dateBucket(date).toISOString()}return cache[cache_key]},get:function(date){var value=this[this.getKey(date)];return this.klass.isValidValue(value)?value:null},_set:function(date,value){if(this.has(date)){this[this.getKey(date)]=value;this.$initializeObjectProperties(date,value)}else{this[this.getKey(date)]=value;this._setAllFromObject(this.toObject())}},_setAllFromObject:function(timestamp_indexed_object){timestamp_indexed_object=this.klass.dateBucketObject(timestamp_indexed_object);this._setAllFromObjectPrevalidated(timestamp_indexed_object)},_setAllFromObjectPrevalidated:function(timestamp_indexed_object){for(var key in this){delete this[key]}for(var key in timestamp_indexed_object){this[key]=timestamp_indexed_object[key]}this.$initializeObjectProperties()},keys:function(){var keys=[];for(var key in this){keys.push(key)}return keys},dates:function(){return this.keys().map(function(key){return moment(key)})},values:function(){var values=[];for(var key in this){values.push(this[key])}return values},size:function(){return this.keys().length},toObject:function(){var object={};for(var key in this){object[key]=this[key]}return object},clone:function(){return new this.klass(this.toObject())},mapValues:function(callback,context){var mapped_data=_.mapValues(this.toObject(),callback,context);return this.klass.init(mapped_data)},$latest:function(){var value=_(this.toObject()).omit(_.isNull).values().last();return this.klass.isValidValue(value)?value:null},$latest_date:function(){var value=_(this.toObject()).omit(_.isNull).keys().last();return value&&moment(value)||null},$first:function(){var value=_(this.toObject()).omit(_.isNull).values().first();return this.klass.isValidValue(value)?value:null},$first_date:function(){var value=_(this.toObject()).omit(_.isNull).keys().first();return value&&moment(value)||null},$max_timeframe_id:function(){return moment().diff(this.first_date,"months")||0},$start_datestring:function(){return _(this.keys()).first()},$start_date:function(){return moment(this.$start_datestring())},$end_datestring:function(){return _(this.keys()).last()},$end_date:function(){return moment(this.$end_datestring())},subsetDateRange:function(){var date_range=_(this.klass.argumentsToFlattenedFilteredArray(arguments)).map(String).sortBy().value();var start_date=_.first(date_range);var end_date=_.last(date_range);return this._subsetDateRange(start_date,end_date)},_subsetDateRange:function(start_date,end_date){var timestamp_indexed_object={};var keys=this.keys();for(var i=0,n=keys.length;i<n;i++){if(keys[i]>=start_date){break}}for(;i<n;i++){if(keys[i]>end_date){break}timestamp_indexed_object[keys[i]]=this[keys[i]]}return this.klass.init(timestamp_indexed_object,{prevalidated:true})},timeframe:function(input){var months=_.isObject(input)?Number(input.timeframe_id):Number(input)||0;if(!_.isFinite(months)||months===0){return this}var unit=this.klass.dateBucketSize||"month";return this.subsetDateRange(moment(),moment().add(-months,unit))},extend:{dateBucketSide:"endOf",dateBucketSize:"month",resolve:function(){this.dateBucketSize=moment.normalizeUnits(this.dateBucketSize);this._dateBucketSizeIsDay=_(["day","hour","minute","second","millisecond"]).includes(this.dateBucketSize);this.callSuper()},init:function(timestamp_indexed_object,options){return new this(timestamp_indexed_object,options)},loadFromUuid:function(uuid,options){var self=this;options={timeframe_id:options.timeframe_id||0};var timeseries=ApiBaseClass.loadUuid(uuid);if(!timeseries||!timeseries.$loadPromise){return $q.when(null)}return timeseries.$loadPromise.then(function(timeseries){if(!timeseries.isA(DateBucket)){timeseries=_.get(timeseries,"returns_time_series")||timeseries}if(!timeseries.isA(DateBucket)&&_.get(timeseries,"base_share_class")){uuid=_.get(timeseries,"base_share_class.uuid");return self.loadFromUuid(uuid,options)}if(!timeseries.isA(DateBucket)){return null}else{return timeseries.timeframe(options.timeframe_id)}})},isValidValue:function(value){return _.isFinite(value)},incrementDate:function(date){var cache=DateBucketCache["incrementDate"];var cache_key=date instanceof moment?Number(date):date;if(!cache[cache_key]){cache[cache_key]=this.dateBucket(moment(date).add(1,this.dateBucketSize));Object.freeze(cache[cache_key])}return cache[cache_key]},dateBucket:function(date){var cache=DateBucketCache["dateBucket"];var cache_key=date instanceof moment?Number(date):date;if(!cache[cache_key]){if(this._dateBucketSizeIsDay){cache[cache_key]=moment(date)[this.dateBucketSide](this.dateBucketSize)}else{cache[cache_key]=moment(date)[this.dateBucketSide](this.dateBucketSize).startOf("day")}Object.freeze(cache[cache_key])}return cache[cache_key]},dateArray:function(date_array){if(!_.isArray(date_array)||date_array.length===0){return[]}var dates=_(date_array).filter().sortBy().value();var start_date=this.dateBucket(_.first(dates));var end_date=this.dateBucket(_.last(dates));var output=[];for(var date=start_date;date<=end_date;date=this.incrementDate(date)){output.push(date)}return output},dateBucketObject:function(timestamp_indexed_object){var key;var date_strings=[];for(key in timestamp_indexed_object){if(!_.isNull(timestamp_indexed_object[key])&&!_.isUndefined(timestamp_indexed_object[key])){date_strings.push(key)}}date_strings.sort();var date_range=this.dateArray(date_strings);var output={};for(var i=0,n=date_range.length;i<n;i++){output[date_range[i]]=null}for(key in timestamp_indexed_object){if(timestamp_indexed_object[key]!==null&&timestamp_indexed_object[key]!==undefined){output[this.dateBucket(key)]=timestamp_indexed_object[key]}}return output},subsetDateRange:function(timestamp_indexed_object,start_date,end_date){return this.init(timestamp_indexed_object,{prevalidated:true}).subsetDateRange(start_date,end_date)},timeframe:function(timestamp_indexed_object,months){return this.init(timestamp_indexed_object,{prevalidated:true}).timeframe(months)},toCalc:function(value){if(value===null){return null}if(_.isFinite(value)){return value===0?0:value/100}if(_.isNumber(value)){return value||null}if(_.isArray(value)){return _.map(value,this.toCalc,this)}if(_.isObject(value)){return _.mapValues(_.clone(value),this.toCalc,this)}else{return null}},fromCalc:function(value){if(value===null){return null}if(_.isFinite(value)){return value*100}if(_.isNumber(value)){return value||null}if(_.isArray(value)){return _.map(value,this.fromCalc,this)}if(_.isObject(value)){return _.mapValues(_.clone(value),this.fromCalc,this)}else{return null}},toCompounded:function(fund_returns,base_multiplier){var was_array=_.isArray(fund_returns);base_multiplier=base_multiplier||1e3;var count=1;var compounded_returns=_(fund_returns).thru(this.toCalc,this).mapValues(function(value){count=count*(1+(value||0));return count}).mapValues(function(value){return value*base_multiplier}).value();if(was_array){compounded_returns=_.values(compounded_returns)}return compounded_returns},thruCalcToNumber:function(fund_returns,callback,context){return _(fund_returns).values().reject(_.isNull).thru(this.toCalc,this).thru(function(values_array){context=context||this;return callback.call(context,values_array)}).thru(function(value){return _.isFinite(value)?value:0}).thru(this.fromCalc,this).value()},argumentsToFlattenedFilteredArray:function(args){var array_of_returns=[];if(args&&args.length){for(var i=0,ni=args.length;i<ni;i++){if(_.isArray(args[i])){for(var j=0,nj=args[i].length;j<nj;j++){if(_.isArray(args[i][j])){for(var k=0,nk=args[i][j].length;k<nk;k++){if(!_.isNull(args[i][j][k])&&!_.isUndefined(args[i][j][k])){array_of_returns.push(args[i][j][k])}}}else{if(!_.isNull(args[i][j])&&!_.isUndefined(args[i][j])){array_of_returns.push(args[i][j])}}}}else{if(!_.isNull(args[i])&&!_.isUndefined(args[i])){array_of_returns.push(args[i])}}}}return array_of_returns},groupByDate:function(){return this.init(this.groupByDateObject.apply(this,arguments),{prevalidated:true})},groupByDateObject:function(){var array_of_returns=this.argumentsToFlattenedFilteredArray(arguments);return this._groupByDateObject(array_of_returns)},_groupByDateObject:function(array_of_returns){var keys=this.groupByDateKeys(array_of_returns);var output={};for(var k=0,nk=keys.length;k<nk;k++){var key=keys[k];var row=[];row.length=array_of_returns.length;for(var i=0,ni=array_of_returns.length;i<ni;i++){var value=array_of_returns[i][key];value=typeof value!=="undefined"?value:null;row[i]=value}output[key]=row}return output},groupByDateKeys:function(){var array_of_returns=this.argumentsToFlattenedFilteredArray(arguments);return this._groupByDateKeys(array_of_returns)},_groupByDateKeys:function(array_of_returns){var keys=[];var keys_seen={};for(var i=0,ni=array_of_returns.length;i<ni;i++){for(var key in array_of_returns[i]){keys_seen[key]||keys.push(key);keys_seen[key]=true}}keys.sort();return keys},invokeTimeframeOptions:function(options){options=_.isObject(options)?options:{};if(options.timeframe_id){for(var key in options){if(_.isFunction(_.get(options,[key,"timeframe"]))){options[key]=options[key].timeframe(options.timeframe_id)}}delete options.timeframe_id}return options}}});return DateBucket});angular.module("edgefolio.models").factory("TimeSeries",function($q,kurtosis,covariance,Edgefolio,ApiFieldGenerator,DateBucket,AggregationDefinitions){var TimeSeries=new JS.Class("TimeSeries",DateBucket,{$initializeObjectProperties:function(){this.callSuper()},$statistics:function(options){options=_.extend({fund_returns:this},options);var output=this.klass.statistics(options);return output},toCalc:function(options){return new this(this.klass.toCalc(this),{prevalidated:true})},fromCalc:function(options){return new this(this.klass.toCalc(this),{prevalidated:true})},groupByDateObject:function(options){return new this(this.klass.groupByDateObject([this,arguments]),{prevalidated:true})},excess:function(options){options=_.extend({fund_returns:this},options);if(!options.benchmark_returns&&!options.risk_free_returns){return null}return this.klass.excess(options)},mean:function(options){options=_.extend({fund_returns:this},options);return this.klass.mean(options)},expected_return:function(options){options=_.extend({fund_returns:this},options);return this.klass.expected_return(options)},standard_deviation:function(options){options=_.extend({fund_returns:this},options);return this.klass.standard_deviation(options)},annualized_standard_deviation:function(options){options=_.extend({fund_returns:this},options);return this.klass.annualized_standard_deviation(options)},annualized_volatility:function(options){options=_.extend({fund_returns:this},options);return this.klass.annualized_volatility(options)},downside_deviation:function(options){options=_.extend({fund_returns:this},options);return this.klass.downside_deviation(options)},skewness:function(options){options=_.extend({fund_returns:this},options);return this.klass.skewness(options)},kurtosis:function(options){options=_.extend({fund_returns:this},options);return this.klass.kurtosis(options)},period_return:function(options){options=_.extend({fund_returns:this},options);return this.klass.period_return(options)},annualized_compounded_return:function(options){options=_.extend({fund_returns:this},options);return this.klass.annualized_compounded_return(options)},annualized_period_return:function(options){options=_.extend({fund_returns:this,track_record_years:0},options);return this.klass.annualized_period_return(options)},maximum_drawdown:function(options){options=_.extend({fund_returns:this},options);return this.klass.maximum_drawdown(options)},sharpe_ratio:function(options){options=_.extend({fund_returns:this},options);if(!options.risk_free_returns){return null}return this.klass.sharpe_ratio(options)},annualized_sharpe_ratio:function(options){options=_.extend({fund_returns:this},options);if(!options.risk_free_returns){return null}return this.klass.annualized_sharpe_ratio(options)},sortino_ratio:function(options){options=_.extend({fund_returns:this},options);if(!options.risk_free_returns){return null}return this.klass.sortino_ratio(options)},annualized_sortino_ratio:function(options){options=_.extend({fund_returns:this},options);if(!options.benchmark_returns){return null}return this.klass.annualized_sortino_ratio(options)},correlation_coefficient:function(options){options=_.extend({fund_returns:this},options);if(!options.benchmark_returns){return null}return this.klass.correlation_coefficient(options)},beta:function(options){options=_.extend({fund_returns:this},options);if(!options.benchmark_returns){return null}if(!options.risk_free_returns){return null}return this.klass.beta(options)},annualized_beta:function(options){options=_.extend({fund_returns:this},options);if(!options.benchmark_returns){return null}if(!options.risk_free_returns){return null}return this.klass.annualized_beta(options)},alpha:function(options){options=_.extend({fund_returns:this},options);if(!options.benchmark_returns){return null}if(!options.risk_free_returns){return null}return this.klass.alpha(options)},annualized_alpha:function(options){options=_.extend({fund_returns:this},options);if(!options.benchmark_returns){return null}if(!options.risk_free_returns){return null}return this.klass.annualized_alpha(options)},information_ratio:function(options){options=_.extend({fund_returns:this},options);if(!options.benchmark_returns){return null}if(!options.risk_free_returns){return null}return this.klass.information_ratio(options)},extend:{statistics:function(options){options=options||{};options.fund=options.fund||options.fund_id&&Edgefolio.Fund.load(options.fund_id)||null;options.share_class=options.share_class||options.share_class_id&&Edgefolio.ShareClass.load(options.share_class_id)||null;options.benchmark=options.benchmark||options.benchmark_id&&Edgefolio.Index.load(options.benchmark_id)||null;options.risk_free_index=options.risk_free_index||Edgefolio.Index.load(options.risk_free_index_id||Edgefolio.Fund.risk_free_index_id)||null;options.fund=options.fund||_.get(options.share_class,"fund");options.share_class=options.share_class||_.get(options.fund,"base_share_class");options.benchmark=options.benchmark||_.get(options.fund,"category_benchmark_index");options.risk_free_index=options.risk_free_index||_.get(options.fund,"risk_free_index");options={fund_returns:options.fund_returns||_.get(options.share_class,"returns_time_series")||null,benchmark_returns:options.benchmark_returns||_.get(options.benchmark,"returns_time_series")||null,risk_free_returns:options.risk_free_returns||_.get(options.risk_free_index,"returns_time_series")||null,timeframe_id:options.timeframe_id||0};if(_.get(options,"fund_returns.max_timeframe_id")){options.timeframe_id=options.timeframe_id===0?options.fund_returns.max_timeframe_id:Math.min(options.fund_returns.max_timeframe_id,options.timeframe_id)||0}this.invokeTimeframeOptions(options);var output=_.mapValues(AggregationDefinitions,function(aggregation){if(_.isFunction(this[aggregation.id])){return this[aggregation.id](options)}return null},this);return output},excess:function(options){options=this.invokeTimeframeOptions(options);var array_of_returns=_([options.fund_returns,options.benchmark_returns,options.risk_free_returns]).filter().take(2).value();var returns=this.groupByDateObject(array_of_returns);var excess=_(returns).thru(this.toCalc,this).mapValues(function(values_array,date){if(_.isFinite(values_array[0])&&_.isFinite(values_array[1])){return values_array[0]-values_array[1]}else{return null}}).thru(this.fromCalc,this).value();return new this(excess,{prevalidated:true})},mean:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns||null;if(!_.isObject(fund_returns)){return null}return this.thruCalcToNumber(fund_returns,function(values_array){return ss.mean(values_array)})},expected_return:function(options){return this.mean(options)},standard_deviation:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns||null;if(!_.isObject(fund_returns)){return null}return this.thruCalcToNumber(fund_returns,function(values_array){return ss.sampleStandardDeviation(values_array)})},annualized_standard_deviation:function(options){return Math.sqrt(12)*this.standard_deviation(options)},annualized_volatility:function(options){return this.annualized_standard_deviation(options)},downside_deviation:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns||null;var margin=options.margin||0;if(!_.isObject(fund_returns)){return null}margin=_.isFinite(margin)?margin:0;return _(fund_returns).values().reject(_.isNull).thru(this.toCalc,this).filter(function(value){return value<margin}).map(function(value){return value-margin}).thru(function(values_array){return ss.sampleStandardDeviation(values_array)}).thru(function(value){return _.isFinite(value)?value:0}).thru(this.fromCalc,this).value()},skewness:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns||null;if(!_.isObject(fund_returns)){return null}return this.thruCalcToNumber(fund_returns,function(values_array){return ss.sampleSkewness(values_array)})},kurtosis:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns||null;if(!_.isObject(fund_returns)){return null}return kurtosis(fund_returns)},period_return:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns||null;if(!_.isObject(fund_returns)){return null}return this.thruCalcToNumber(fund_returns,function(values_array){var product=_.reduce(values_array,function(product,returns){return product*(1+returns);
},1)-1;return _.isFinite(product)?product:0})},annualized_compounded_return:function(options){return this.annualized_period_return(options)},annualized_period_return:function(options){if(!_.isObject(options&&options.fund_returns)){return null}var track_record_years=(options.fund_returns.max_timeframe_id+1)/12||1;var period_return=1+this.toCalc(this.period_return(options));var annualized_period_return=Math.pow(period_return,1/track_record_years)-1;return this.fromCalc(annualized_period_return)||0},maximum_drawdown:function(options){options=this.invokeTimeframeOptions(options);if(!_.isObject(options.fund_returns)){return null}var fund_returns=_.values(options.fund_returns)||null;var compounded_returns=[];var cur_return=0;compounded_returns=_.map(fund_returns,function(r){cur_return+=Math.log(1+r/100)||0;return cur_return});var cur_max=null;var max_drawdown=null;_.each(compounded_returns,function(cur){if(cur_max===null||cur>cur_max){cur_max=cur}var drawdown=cur-cur_max;if(max_drawdown===null||drawdown<max_drawdown){max_drawdown=drawdown}});if(max_drawdown===null){return 0}else{return-(1-Math.exp(max_drawdown))*100}},sharpe_ratio:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var risk_free_returns=options.risk_free_returns;if(!_.isObject(fund_returns)||!_.isObject(risk_free_returns)){return null}var excess_returns_series=this.excess({fund_returns:fund_returns,risk_free_returns:risk_free_returns});var expected_value=excess_returns_series.mean();var monthly_volatility=excess_returns_series.standard_deviation();var proximity=1e-5;if(0-proximity<=monthly_volatility&&monthly_volatility<=proximity+0){return 0}else{return expected_value/monthly_volatility}},annualized_sharpe_ratio:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var risk_free_returns=options.risk_free_returns;if(!_.isObject(fund_returns)||!_.isObject(risk_free_returns)){return null}return Math.sqrt(12)*this.sharpe_ratio(options)},sortino_ratio:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var risk_free_returns=options.risk_free_returns;if(!_.isObject(fund_returns)||!_.isObject(risk_free_returns)){return null}var excess_returns_series=this.excess({fund_returns:fund_returns,risk_free_returns:risk_free_returns});var expected_value=excess_returns_series.mean();var monthly_downside_deviation=this.downside_deviation(excess_returns_series,0);var proximity=1e-5;if(0-proximity<=monthly_downside_deviation&&monthly_downside_deviation<=proximity+0){return 0}else{return this.toCalc(expected_value/monthly_downside_deviation)}},annualized_sortino_ratio:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var benchmark_returns=options.benchmark_returns;if(!_.isObject(fund_returns)||!_.isObject(benchmark_returns)){return null}return Math.sqrt(12)*this.sortino_ratio(options)},correlation_coefficient:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var benchmark_returns=options.benchmark_returns;if(!_.isObject(fund_returns)||!_.isObject(benchmark_returns)){return null}return _([fund_returns,benchmark_returns]).thru(this.groupByDateObject,this).reject(function(row){for(var i=0,n=row.length;i<n;i++){if(row[i]===null||row[i]===undefined){return true}}return false}).thru(function(group_by_date){return ss.sampleCorrelation(_.pluck(group_by_date,0),_.pluck(group_by_date,1))}).thru(this.fromCalc,this).value()},beta:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var benchmark_returns=options.benchmark_returns;var risk_free_returns=options.risk_free_returns;if(!_.isObject(fund_returns)||!_.isObject(benchmark_returns)||!_.isObject(risk_free_returns)){return null}if(fund_returns.size()<2){return 0}var fund_excess_returns=this.excess({fund_returns:fund_returns,risk_free_returns:risk_free_returns});var benchmark_excess_returns=this.excess({benchmark_returns:benchmark_returns,risk_free_returns:risk_free_returns});var returns_matrix=this.groupByDateObject(fund_excess_returns,benchmark_excess_returns);try{var C=covariance(this.toCalc(_.pluck(returns_matrix,0)),this.toCalc(_.pluck(returns_matrix,1)),{bias:true});var excess_returns_covariance=C[0][1];var benchmark_excess_returns_variance=C[1][1]}catch(exception){console.error("TimeSeries.beta()","exception",exception)}var beta=excess_returns_covariance/benchmark_excess_returns_variance||0;return beta},annualized_beta:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var benchmark_returns=options.benchmark_returns;var risk_free_returns=options.risk_free_returns;if(!_.isObject(fund_returns)||!_.isObject(benchmark_returns)||!_.isObject(risk_free_returns)){return null}return 12*this.beta(options)},alpha:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var benchmark_returns=options.benchmark_returns;var risk_free_returns=options.risk_free_returns;if(!_.isObject(fund_returns)||!_.isObject(benchmark_returns)||!_.isObject(risk_free_returns)){return null}var fund_expected_excess_mean=this.excess({fund_returns:fund_returns,risk_free_returns:risk_free_returns}).mean();var benchmark_expected_excess_mean=this.excess({benchmark_returns:benchmark_returns,risk_free_returns:risk_free_returns}).mean();var beta=this.beta({fund_returns:fund_returns,benchmark_returns:benchmark_returns,risk_free_returns:risk_free_returns});return fund_expected_excess_mean-beta*benchmark_expected_excess_mean},annualized_alpha:function(options){return 12*this.alpha(options)},information_ratio:function(options){options=this.invokeTimeframeOptions(options);var fund_returns=options.fund_returns;var benchmark_returns=options.benchmark_returns;if(!_.isObject(fund_returns)||!_.isObject(benchmark_returns)){return null}return _(this.groupByDateObject(fund_returns,benchmark_returns)).values().thru(this.toCalc,this).map(function(fb_array){if(_.isFinite(fb_array[0])&&_.isFinite(fb_array[1])){return fb_array[0]-fb_array[1]}else{return null}}).reject(_.isNull).thru(function(values){return ss.mean(values)/ss.sampleStandardDeviation(values)}).thru(function(relative_deviation){return _.isFinite(relative_deviation)?relative_deviation:0}).thru(function(relative_deviation){var proximity=1e-5;if(0-proximity<=relative_deviation&&relative_deviation<=proximity+0){return 0}else{return relative_deviation}}).thru(this.fromCalc,this).value()}}});return TimeSeries});angular.module("edgefolio.models").factory("DateBucketMapped",function(ApiFieldGenerator,DateBucket,DateBucketValue){var DateBucketMapped=new JS.Class("DateBucketMapped",DateBucket,{_set:function(date,value){value=this.klass.mappingKlass.init(value,date,this);this.callSuper(date,value)},_setAllFromObject:function(timestamp_indexed_object){var self=this;if(this.klass.mappingKlass){timestamp_indexed_object=_.mapValues(timestamp_indexed_object,function(value,date){return self.klass.mappingKlass.init(value,date,self)})}return this.callSuper(timestamp_indexed_object)},toObject:function(){var self=this;return _.mapValues(this,function(value,key){return self.klass.isValidValue(value)?value.value():null})},extend:{mappingKlass:DateBucketValue,isValidValue:function(value){return value&&value.klass&&value.isA(this.mappingKlass)||false}}});return DateBucketMapped});angular.module("edgefolio.models").factory("DateBucketValue",function(ApiFieldGenerator){var DateBucketValue=new JS.Class("DateBucketValue",{display:null,moment:null,parent:null,initialize:function(value,key,parent){this.parent=parent||null;ApiFieldGenerator.selfCaching(this,"moment",function(){return moment(this.date)});this.date=key;this.display=value},value:function(){return this.display},toString:function(){return String(this.display)},extend:{setName:function(name){return this.callSuper(this.displayName||name)},init:function(value,key,parent){if(value===null||value===undefined){return null}else if(value&&value.klass&&value.isA(this)){return value}else{return new this(value,key,parent)}}}});return DateBucketValue});angular.module("edgefolio.models").factory("TimeSeriesValue",function(ApiFieldGenerator,DateBucketValue){var TimeSeriesValue=new JS.Class("TimeSeriesValue",DateBucketValue,{calc:null,display:null,moment:null,parent:null,roundTo:5,initialize:function(value,key,parent){Object.defineProperties(this,{display:{enumerable:true,configurable:false,get:function(){return _.isFinite(this.calc)?_.round(this.calc*100,this.roundTo):null},set:function(value){this.calc=_.isFinite(value)?value&&value/100:null}}});this.callSuper()}});return TimeSeriesValue});
